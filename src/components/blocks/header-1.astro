---
import MenuIcon from 'lucide-static/icons/menu.svg';

import { Button } from '@/components/ui/button';
import { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';
import { Header, HeaderActions } from '@/components/ui/header';
import { Icon } from '@/components/ui/icon';
import { Logo, LogoImage, LogoText } from '@/components/ui/logo';
import {
  NavigationMenu,
  NavigationMenuContent,
  NavigationMenuItem,
  NavigationMenuLink,
  NavigationMenuList,
  NavigationMenuSub,
  NavigationMenuSubItem,
  NavigationMenuSubLink,
  NavigationMenuTrigger,
} from '@/components/ui/navigation-menu';
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet';
import {
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
} from '@/components/ui/sidebar';
import { ThemeToggle } from '@/components/ui/theme-toggle';

interface Props {
  logo?: {
    src?: string;
    alt?: string;
    text?: string;
    href?: string;
  };
  links?: {
    icon?: string;
    text?: string;
    href?: string;
    target?: string;
  }[];
  socials?: string[];
  menus?: {
    text?: string;
    href?: string;
    links?: {
      text?: string;
      href?: string;
    }[];
  }[];
}

const { logo, menus, links, socials } = Astro.props;
---

<Header>
  <Logo href={logo?.href || '/'}>
    <LogoImage src={logo?.src} alt={logo?.alt} />
    <LogoText>{logo?.text}</LogoText>
  </Logo>
  {
    menus && menus.length > 0 && (
      <NavigationMenu class="mr-auto @max-5xl:hidden">
        <NavigationMenuList>
          {menus.map(({ text, href, links }) => (
            <NavigationMenuItem>
              {links && links.length > 0 ? (
                <>
                  <NavigationMenuTrigger href={href}>{text}</NavigationMenuTrigger>
                  <NavigationMenuContent>
                    <NavigationMenuSub>
                      {links?.map((link) => (
                        <NavigationMenuSubItem>
                          <NavigationMenuSubLink href={link.href}>
                            {link.text}
                          </NavigationMenuSubLink>
                        </NavigationMenuSubItem>
                      ))}
                    </NavigationMenuSub>
                  </NavigationMenuContent>
                </>
              ) : (
                <NavigationMenuLink variant="trigger" href={href}>
                  {text}
                </NavigationMenuLink>
              )}
            </NavigationMenuItem>
          ))}
        </NavigationMenuList>
      </NavigationMenu>
    )
  }
  <HeaderActions class="@max-5xl:hidden">
    {
      socials?.map((social) => (
        <>
          <Button variant="ghost" size="icon-sm" href={social} target="_blank">
            <Icon href={social} />
          </Button>
        </>
      ))
    }
    <ThemeToggle />
    {
      links?.map(({ icon, text, ...link }, i) => (
        <Button variant={i === links.length - 1 ? 'default' : 'outline'} size="sm" {...link}>
          {icon && <Icon name={icon} />}
          {text}
        </Button>
      ))
    }
  </HeaderActions>
  <Sheet class="first:ml-auto">
    <SheetTrigger class="@5xl:hidden" variant="ghost" size="icon" name="open-menu-button">
      <MenuIcon class="size-5" />
    </SheetTrigger>
    <SheetContent class="overflow-y-auto px-4 py-12">
      <div class="flex flex-1 flex-col">
        <SidebarMenu>
          {
            menus?.map((menu) => (
              <SidebarMenuItem>
                {menu.links && menu.links.length > 0 ? (
                  <Collapsible>
                    <CollapsibleTrigger>
                      <SidebarMenuButton class="h-10 rounded-md px-4 text-xl">
                        {menu.text}
                      </SidebarMenuButton>
                    </CollapsibleTrigger>
                    <CollapsibleContent>
                      <SidebarMenuSub>
                        {menu.links?.map((link) => (
                          <SidebarMenuSubItem>
                            <SidebarMenuSubButton href={link.href}>
                              {link.text}
                            </SidebarMenuSubButton>
                          </SidebarMenuSubItem>
                        ))}
                      </SidebarMenuSub>
                    </CollapsibleContent>
                  </Collapsible>
                ) : (
                  <SidebarMenuButton
                    class="h-10 w-full rounded-md px-4 text-xl has-[>svg]:px-4"
                    href={menu.href}
                  >
                    {menu.text}
                  </SidebarMenuButton>
                )}
              </SidebarMenuItem>
            ))
          }
        </SidebarMenu>
        <HeaderActions class="flex flex-col gap-2">
          {
            links?.map(({ icon, text, ...link }, i) => (
              <Button
                variant={i === links.length - 1 ? 'default' : 'secondary'}
                class="w-full"
                {...link}
              >
                {icon && <Icon name={icon} />}
                {text}
              </Button>
            ))
          }
        </HeaderActions>
        <div class="border-border mt-auto border-t pt-4">
          <div class="mb-3 flex items-center justify-between px-1">
            <span class="text-muted-foreground text-sm font-medium">Theme</span>
            <ThemeToggle />
          </div>
          {
            socials && socials.length > 0 && (
              <div class="flex items-center gap-2 px-1">
                {socials.map((social) => (
                  <Button variant="ghost" size="icon" href={social} target="_blank">
                    <Icon href={social} />
                  </Button>
                ))}
              </div>
            )
          }
        </div>
      </div>
    </SheetContent>
  </Sheet>
</Header>
