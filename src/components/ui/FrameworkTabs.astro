---
/**
 * FrameworkTabs - Framework selector tabs for pattern pages
 *
 * A shared component for switching between framework implementations.
 * Saves the selected framework to localStorage for next visit.
 */
import { FRAMEWORKS, FRAMEWORK_INFO, type Framework } from '@/lib/frameworks';
import { withBase } from '@/lib/utils';
import FrameworkIcon from '@/components/ui/FrameworkIcon.astro';

interface Props {
  /** The pattern name (e.g., 'button', 'tabs') */
  pattern: string;
  /** The currently active framework */
  currentFramework: Framework;
}

const { pattern, currentFramework } = Astro.props;
---

<div class="border-border mb-8 flex gap-2 border-b" role="tablist">
  {
    FRAMEWORKS.map((fw) => {
      const info = FRAMEWORK_INFO[fw];
      const isActive = fw === currentFramework;
      const href = withBase(`/patterns/${pattern}/${fw}/`);

      return (
        <a
          href={href}
          class:list={[
            'inline-flex items-center gap-2 border-b-2 px-4 py-2 transition-colors',
            isActive
              ? 'framework-tab-active font-medium'
              : 'text-muted-foreground hover:text-foreground border-transparent',
          ]}
          style={
            isActive
              ? `border-color: ${info.color}; --fw-color: ${info.colorForeground}; --fw-color-dark: ${info.colorForegroundDark};`
              : undefined
          }
          aria-current={isActive ? 'page' : undefined}
          role="tab"
          aria-selected={isActive ? 'true' : 'false'}
        >
          <FrameworkIcon framework={fw} class="h-4 w-4" />
          {info.label}
        </a>
      );
    })
  }
</div>

<style>
  .framework-tab-active {
    color: var(--fw-color);
  }

  :global(.dark) .framework-tab-active {
    color: var(--fw-color-dark);
  }
</style>

<script>
  document.querySelectorAll<HTMLAnchorElement>('[role="tablist"] a[role="tab"]').forEach((tab) => {
    tab.addEventListener('click', () => {
      const pathSegments = new URL(tab.href).pathname.split('/').filter(Boolean);
      const framework = pathSegments[pathSegments.length - 1];
      if (framework) {
        localStorage.setItem('apg-selected-framework', framework);
      }
    });
  });
</script>
