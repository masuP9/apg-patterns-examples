---
import { FRAMEWORK_INFO, type Framework } from '@/lib/frameworks';
import { getAvailablePatterns, getPlannedPatterns } from '@/lib/patterns';
import { SidebarMenu, SidebarMenuItem, SidebarMenuButton } from '@/components/ui/sidebar';
import { withBase } from '@/lib/utils';
import FrameworkIcon from '@/components/ui/FrameworkIcon.astro';
import {
  type Locale,
  getLocaleFromUrl,
  getLocalizedPath,
  useTranslation,
  getPatternName,
} from '@/i18n';

interface Props {
  currentPattern: string;
  currentFramework: Framework;
  locale?: Locale;
}

const { currentPattern, currentFramework } = Astro.props;
const locale = Astro.props.locale ?? getLocaleFromUrl(Astro.url);
const t = useTranslation(locale);

const availablePatterns = getAvailablePatterns();
const plannedPatterns = getPlannedPatterns();
const frameworkInfo = FRAMEWORK_INFO[currentFramework];
---

<nav aria-label="Pattern navigation" class="w-full">
  <div class="mb-4 flex items-center justify-between">
    <h2 class="text-foreground px-2 text-sm font-semibold">{t('patterns.title')}</h2>
    <span
      class="framework-badge inline-flex items-center gap-1.5 rounded-full px-2 py-0.5 text-xs font-medium"
      style={`background-color: ${frameworkInfo.colorLight}; --fw-color: ${frameworkInfo.colorForeground}; --fw-color-dark: ${frameworkInfo.colorForegroundDark};`}
    >
      <FrameworkIcon framework={currentFramework} class="h-3.5 w-3.5" />
      {frameworkInfo.label}
    </span>
  </div>

  <SidebarMenu>
    {
      availablePatterns.map((pattern) => (
        <SidebarMenuItem>
          <SidebarMenuButton
            href={withBase(
              getLocalizedPath(`/patterns/${pattern.id}/${currentFramework}/`, locale)
            )}
            active={currentPattern === pattern.id}
            aria-current={currentPattern === pattern.id ? 'page' : undefined}
            size="sm"
            class="text-sm"
          >
            <span class="inline-flex w-5 justify-center text-xs" aria-hidden="true">
              {pattern.icon}
            </span>
            <span>{getPatternName(pattern.id, pattern.name, locale)}</span>
          </SidebarMenuButton>
        </SidebarMenuItem>
      ))
    }
  </SidebarMenu>

  {
    plannedPatterns.length > 0 && (
      <>
        <div class="mt-6 mb-2">
          <h3 class="text-muted-foreground px-2 text-xs font-medium tracking-wider uppercase">
            {t('status.planned')}
          </h3>
        </div>
        <ul class="flex w-full min-w-0 flex-col gap-1 pb-8">
          {plannedPatterns.map((pattern) => (
            <li class="group/menu-item relative">
              <span class="text-muted-foreground flex h-7 w-full cursor-default items-center gap-2 overflow-hidden rounded-md px-2 text-left text-sm opacity-60">
                <span class="inline-flex w-5 justify-center text-xs" aria-hidden="true">
                  {pattern.icon}
                </span>
                <span class="truncate">{getPatternName(pattern.id, pattern.name, locale)}</span>
                <span class="sr-only">({t('status.planned')})</span>
              </span>
            </li>
          ))}
        </ul>
      </>
    )
  }
</nav>

<style>
  .framework-badge {
    color: var(--fw-color);
  }

  :global(.dark) .framework-badge {
    color: var(--fw-color-dark);
  }
</style>
