---
import type { HTMLAttributes } from "astro/types"
import { cva, type VariantProps } from "class-variance-authority"
import XIcon from "lucide-static/icons/x.svg"

import { cn } from "@/lib/utils"

const dialogVariants = cva(
  [
    "group/sheet",
    "fixed inset-0 z-50 m-0 max-h-none max-w-none border-0 bg-transparent p-0",
    // Added for quick fix over horizontal scroll issue
    "overflow-x-hidden",
    // Animation: opacity
    "transition-discrete starting:opacity-0 transition-[opacity,overlay,display] duration-300 ease-in-out",
    // Backdrop styles
    "backdrop:bg-black/0 backdrop:transition-[background-color,overlay,display] backdrop:starting:bg-black/0 backdrop:duration-300 backdrop:ease-in-out",
    "data-[state=open]:backdrop:bg-black/50"
  ],
  {
    variants: {
      side: {
        right: "ml-auto h-full w-3/4 sm:max-w-sm",
        left: "mr-auto h-full w-3/4 sm:max-w-sm",
        top: "mb-auto h-auto w-full",
        bottom: "mt-auto h-auto w-full",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

const contentVariants = cva(
  [
    "w-3/4 fixed z-50 bg-background flex h-full flex-col gap-4 shadow-lg",
    "transition transition-transform ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
    // Open state: on-screen
    "group-data-[state=open]/sheet:translate-x-0 group-data-[state=open]/sheet:translate-y-0",
  ],
  {
    variants: {
      side: {
        // Default off-screen position + border
        right: "border-l translate-x-full",
        left: "border-r -translate-x-full",
        top: "border-b -translate-y-full",
        bottom: "border-t translate-y-full",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

type Props = VariantProps<typeof contentVariants> &
  HTMLAttributes<"div"> & {
    showClose?: boolean
  }

const { class: className, side = "right", showClose = true, ...props } = Astro.props

const slot = await Astro.slots.render("default")
---

<dialog
  data-slot="sheet-dialog"
  data-side={side}
  class={cn(dialogVariants({ side }))}
>
  <div
    data-slot="sheet-content"
    data-side={side}
    class={cn(contentVariants({ side }), className)}
    {...props}
  >
    {
      showClose && (
        <button
          type="button"
          data-slot="sheet-close"
          class="focus-visible:outline-ring text-foreground absolute p-3.5 top-2 right-5.25 cursor-pointer rounded-sm border-0 bg-transparent opacity-70 transition-opacity hover:opacity-100 focus-visible:outline-2 focus-visible:outline-offset-2"
          aria-label="Close"
        >
          <XIcon class="size-4" />
        </button>
      )
    }
    <Fragment set:html={slot} />
  </div>
</dialog>
