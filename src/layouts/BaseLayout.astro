---
import '../styles/global.css';
import { Header, HeaderActions } from '@/components/ui/header';
import { Logo, LogoText } from '@/components/ui/logo';
import {
  NavigationMenu,
  NavigationMenuItem,
  NavigationMenuLink,
  NavigationMenuList,
} from '@/components/ui/navigation-menu';
import { NativeSelect, NativeSelectOption } from '@/components/ui/native-select';
import { ThemeToggle, ThemeProvider } from '@/components/ui/theme-toggle';
import { Footer, FooterDescription, FooterGroup, FooterMenu, FooterMenuItem, FooterMenuLink } from '@/components/ui/footer';
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet';
import { SidebarMenu, SidebarMenuButton, SidebarMenuItem } from '@/components/ui/sidebar';
import MenuIcon from 'lucide-static/icons/menu.svg';
import { withBase } from '@/lib/utils';

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'APG Patterns Examples - Accessible component patterns for React, Vue, Svelte, and Astro' } = Astro.props;
const currentPath = Astro.url.pathname;

const navLinks = [
  { text: 'Patterns', href: withBase('/patterns/') },
  { text: 'Guide', href: withBase('/guide/') },
  { text: 'About', href: withBase('/about/') },
];
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href={withBase('/favicon.svg')} />
    <title>{title} | APG Patterns Examples</title>
    <ThemeProvider />
  </head>
  <body class="min-h-screen bg-background text-foreground">
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <Header>
      <Logo href={withBase('/')}>
        <LogoText>APG Patterns</LogoText>
      </Logo>
      <NavigationMenu class="mr-auto @max-lg:hidden">
        <NavigationMenuList>
          {navLinks.map((link) => (
            <NavigationMenuItem>
              <NavigationMenuLink
                aria-current={currentPath.startsWith(link.href) ? 'page' : undefined}
                href={link.href}
              >
                {link.text}
              </NavigationMenuLink>
            </NavigationMenuItem>
          ))}
        </NavigationMenuList>
      </NavigationMenu>
      <HeaderActions class="@max-lg:hidden">
        <NativeSelect id="framework-selector" aria-label="Select framework">
          <NativeSelectOption value="react">React</NativeSelectOption>
          <NativeSelectOption value="vue">Vue</NativeSelectOption>
          <NativeSelectOption value="svelte">Svelte</NativeSelectOption>
          <NativeSelectOption value="astro">Astro</NativeSelectOption>
        </NativeSelect>
        <ThemeToggle />
      </HeaderActions>
      <Sheet class="first:ml-auto">
        <SheetTrigger
          class="@lg:hidden"
          variant="ghost"
          size="icon"
          aria-label="Open menu"
        >
          <MenuIcon class="size-5" />
        </SheetTrigger>
        <SheetContent class="overflow-y-auto px-4 py-12">
          <SidebarMenu>
            {navLinks.map((link) => (
              <SidebarMenuItem>
                <SidebarMenuButton
                  class:list={[
                    "h-10 w-full rounded-md px-4 text-xl has-[>svg]:px-4",
                    currentPath.startsWith(link.href) && "font-medium text-primary"
                  ]}
                  href={link.href}
                >
                  {link.text}
                </SidebarMenuButton>
              </SidebarMenuItem>
            ))}
          </SidebarMenu>
          <HeaderActions class="mt-6 flex flex-col gap-2">
            <NativeSelect id="framework-selector-mobile" aria-label="Select framework">
              <NativeSelectOption value="react">React</NativeSelectOption>
              <NativeSelectOption value="vue">Vue</NativeSelectOption>
              <NativeSelectOption value="svelte">Svelte</NativeSelectOption>
              <NativeSelectOption value="astro">Astro</NativeSelectOption>
            </NativeSelect>
            <ThemeToggle />
          </HeaderActions>
        </SheetContent>
      </Sheet>
    </Header>

    <main id="main-content" class="mx-auto max-w-6xl px-4 py-8">
      <slot />
    </main>

    <Footer>
      <FooterGroup class="items-center text-center">
        <FooterDescription>
          APG Patterns Examples - Accessible component implementations
        </FooterDescription>
        <FooterMenu orientation="horizontal">
          <FooterMenuItem>
            <FooterMenuLink href="https://www.w3.org/WAI/ARIA/apg/" target="_blank">
              WAI-ARIA APG
            </FooterMenuLink>
          </FooterMenuItem>
          <FooterMenuItem>
            <FooterMenuLink href="https://github.com/masuP9/apg-patterns-examples" target="_blank">
              GitHub
            </FooterMenuLink>
          </FooterMenuItem>
        </FooterMenu>
      </FooterGroup>
    </Footer>

    <script>
      // Framework selector - sync both selectors
      const frameworkSelectors = document.querySelectorAll<HTMLSelectElement>('[id^="framework-selector"]');
      const savedFramework = localStorage.getItem('apg-selected-framework') || 'react';

      frameworkSelectors.forEach((selector) => {
        selector.value = savedFramework;
        selector.addEventListener('change', (e) => {
          const target = e.target as HTMLSelectElement;
          localStorage.setItem('apg-selected-framework', target.value);
          // Sync all selectors
          frameworkSelectors.forEach((s) => {
            if (s !== target) s.value = target.value;
          });
        });
      });
    </script>
  </body>
</html>
