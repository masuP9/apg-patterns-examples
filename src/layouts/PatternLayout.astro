---
import BaseLayout from './BaseLayout.astro';
import { PatternSidebar } from '@/components/ui/pattern-sidebar';
import { PatternBreadcrumb } from '@/components/ui/pattern-breadcrumb';
import { type Framework } from '@/lib/frameworks';
import { TableOfContents, type TocItem } from '@/components/ui/toc';
import { type Locale, getLocaleFromUrl } from '@/i18n';

interface Props {
  title: string;
  description?: string;
  pattern: string;
  framework: Framework;
  tocItems?: TocItem[];
  locale?: Locale;
}

const { title, description, pattern, framework, tocItems = [] } = Astro.props;
const locale = Astro.props.locale ?? getLocaleFromUrl(Astro.url);
const hasToc = tocItems.length > 0;
---

<BaseLayout title={title} description={description} locale={locale}>
  <div class="max-w-8xl mx-auto">
    <div
      class:list={[
        'lg:grid lg:gap-16 xl:gap-20',
        hasToc
          ? 'lg:grid-cols-[240px_1fr] xl:grid-cols-[240px_1fr_200px]'
          : 'lg:grid-cols-[240px_1fr]',
      ]}
    >
      <!-- Sidebar (desktop only) -->
      <aside class="hidden lg:block">
        <div class="sticky top-4 max-h-[calc(100vh-2rem)] overflow-y-auto">
          <PatternSidebar currentPattern={pattern} currentFramework={framework} locale={locale} />
        </div>
      </aside>

      <!-- Main content -->
      <div class="max-w-5xl min-w-0">
        <!-- Pattern breadcrumb with dropdown -->
        <PatternBreadcrumb pattern={pattern} framework={framework} locale={locale} />

        <slot />
      </div>

      <!-- Right Sidebar: TOC (xl and above) -->
      {
        hasToc && (
          <aside class="hidden xl:block">
            <div class="sticky top-4">
              <TableOfContents items={tocItems} />
            </div>
          </aside>
        )
      }
    </div>
  </div>
</BaseLayout>
