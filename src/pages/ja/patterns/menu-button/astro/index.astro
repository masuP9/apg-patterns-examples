---
import { withBase } from '@/lib/utils';
import PatternLayout from '../../../../../layouts/PatternLayout.astro';
import { useTranslation } from '@/i18n';
import MenuButton from '@patterns/menu-button/MenuButton.astro';
import AccessibilityDocs from '@patterns/menu-button/AccessibilityDocs.ja.astro';
import TestingDocs from '@patterns/menu-button/TestingDocs.ja.astro';
import CodeBlock from '@/components/ui/CodeBlock.astro';
import ExternalLink from '@/components/ui/ExternalLink.astro';
import FrameworkTabs from '@/components/ui/FrameworkTabs.astro';
import { ResponsiveTable } from '@/components/ui/table';
import Heading from '@/components/ui/Heading.astro';
import sourceCode from '@patterns/menu-button/MenuButton.astro?raw';

const locale = 'ja';
const t = useTranslation(locale);

const tocItems = [
  { id: 'demo', text: t('pattern.demo') },
  { id: 'accessibility-features', text: t('pattern.accessibility') },
  { id: 'source-code', text: t('pattern.sourceCode') },
  { id: 'usage', text: t('pattern.usage') },
  { id: 'api', text: t('pattern.api') },
  { id: 'testing', text: t('pattern.testing') },
  { id: 'resources', text: t('pattern.resources') },
];

const actionItems = [
  { id: 'cut', label: 'Cut' },
  { id: 'copy', label: 'Copy' },
  { id: 'paste', label: 'Paste' },
  { id: 'delete', label: 'Delete' },
];

const fileItems = [
  { id: 'new', label: 'New File' },
  { id: 'open', label: 'Open...' },
  { id: 'save', label: 'Save' },
  { id: 'save-as', label: 'Save As...' },
  { id: 'export', label: 'Export', disabled: true },
  { id: 'print', label: 'Print' },
];
---

<PatternLayout
  title="Menu Button - Astro"
  pattern="menu-button"
  framework="astro"
  tocItems={tocItems}
  locale={locale}
>
  <header class="mb-8">
    <h1 class="mb-4 text-3xl font-bold">Menu Button</h1>
    <p class="text-muted-foreground text-lg">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¾ãŸã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ããƒœã‚¿ãƒ³ã€‚</p>
    <a
      href={withBase("/patterns/menu-button/llm.md")}
      target="_blank"
      rel="noopener noreferrer"
      class="mt-4 inline-flex items-center gap-1.5 rounded-full border border-blue-200 bg-blue-50 px-3 py-1 text-sm text-blue-700 transition-colors hover:bg-blue-100 dark:border-blue-800 dark:bg-blue-950 dark:text-blue-300 dark:hover:bg-blue-900"
    >
      <span class="text-base">ğŸ¤–</span>
      AI å®Ÿè£…ã‚¬ã‚¤ãƒ‰
    </a>
  </header>

  <!-- Framework Selector -->
  <FrameworkTabs pattern="menu-button" currentFramework="astro" locale={locale} />

  <!-- Demo Section -->
  <section class="mb-12">
    <Heading level={2} id="demo" class="mb-4 text-xl font-semibold">{t('pattern.demo')}</Heading>

    <!-- Basic -->
    <div class="mb-8">
      <h3 class="mb-3 text-lg font-medium">åŸºæœ¬çš„ãª Menu Button</h3>
      <p class="text-muted-foreground mb-4 text-sm">
        ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‹ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ãã¾ã™ã€‚
      </p>
      <div class="border-border bg-background rounded-lg border p-6">
        <div class="space-y-4">
          <MenuButton items={actionItems} label="Actions" />
          <p id="basic-output" class="text-muted-foreground text-sm">æœ€å¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: None</p>
        </div>
      </div>
    </div>

    <!-- With Disabled Items -->
    <div>
      <h3 class="mb-3 text-lg font-medium">ç„¡åŠ¹ãªé …ç›®ã‚’å«ã‚€</h3>
      <p class="text-muted-foreground mb-4 text-sm">
        ç„¡åŠ¹ãªé …ç›®ã¯ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã«ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚
      </p>
      <div class="border-border bg-background rounded-lg border p-6">
        <div class="space-y-4">
          <MenuButton items={fileItems} label="File" />
          <p id="disabled-output" class="text-muted-foreground text-sm">æœ€å¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: None</p>
          <p class="text-muted-foreground text-xs">
            æ³¨ï¼šã€ŒExportã€ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ãŠã‚Šã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã«ã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã¾ã™
          </p>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Handle itemselect events from Web Components
    document.querySelectorAll('apg-menu-button').forEach((menuButton, index) => {
      const outputId = index === 0 ? 'basic-output' : 'disabled-output';
      const output = document.getElementById(outputId);
      menuButton.addEventListener('itemselect', (e) => {
        const event = e as CustomEvent<{ itemId: string }>;
        if (output) {
          output.textContent = `æœ€å¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${event.detail.itemId}`;
        }
      });
    });
  </script>

  <!-- Accessibility Section -->
  <section class="mb-12">
    <Heading level={2} id="accessibility-features" class="mb-4 text-xl font-semibold"
      >{t('pattern.accessibility')}</Heading
    >
    <AccessibilityDocs />
  </section>

  <!-- Source Code Section -->
  <section class="mb-12">
    <Heading level={2} id="source-code" class="mb-4 text-xl font-semibold"
      >{t('pattern.sourceCode')}</Heading
    >
    <CodeBlock
      collapsible
      collapsedLines={5}
      code={sourceCode}
      lang="astro"
      title="MenuButton.astro"
    />
  </section>

  <!-- Usage Section -->
  <section class="mb-12">
    <Heading level={2} id="usage" class="mb-4 text-xl font-semibold">{t('pattern.usage')}</Heading>
    <CodeBlock
      collapsible
      collapsedLines={5}
      code={`---
import MenuButton from './MenuButton.astro';

const items = [
  { id: 'cut', label: 'Cut' },
  { id: 'copy', label: 'Copy' },
  { id: 'paste', label: 'Paste' },
  { id: 'delete', label: 'Delete', disabled: true },
];
---

<!-- Basic usage -->
<MenuButton items={items} label="Actions" />

<script>
  // Handle selection via custom event
  document.querySelectorAll('apg-menu-button').forEach((menuButton) => {
    menuButton.addEventListener('itemselect', (e) => {
      const event = e as CustomEvent<{ itemId: string }>;
      console.log('Selected:', event.detail.itemId);
    });
  });
</script>`}
      lang="astro"
      title="Example"
    />
  </section>

  <!-- API Section -->
  <section class="mb-12">
    <Heading level={2} id="api" class="mb-4 text-xl font-semibold">{t('pattern.api')}</Heading>

    <h3 class="mb-3 text-lg font-medium">MenuButton Props</h3>
    <ResponsiveTable class="mb-6">
      <table class="w-full border-collapse">
        <thead>
          <tr class="border-border border-b">
            <th class="py-2 pr-4 text-left">ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</th>
            <th class="py-2 pr-4 text-left">å‹</th>
            <th class="py-2 pr-4 text-left">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</th>
            <th class="py-2 text-left">èª¬æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-border border-b">
            <td class="py-2 pr-4"><code>items</code></td>
            <td class="text-muted-foreground py-2 pr-4">MenuItem[]</td>
            <td class="text-muted-foreground py-2 pr-4">required</td>
            <td class="py-2">ãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›®ã®é…åˆ—</td>
          </tr>
          <tr class="border-border border-b">
            <td class="py-2 pr-4"><code>label</code></td>
            <td class="text-muted-foreground py-2 pr-4">string</td>
            <td class="text-muted-foreground py-2 pr-4">required</td>
            <td class="py-2">ãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ</td>
          </tr>
          <tr class="border-border border-b">
            <td class="py-2 pr-4"><code>defaultOpen</code></td>
            <td class="text-muted-foreground py-2 pr-4">boolean</td>
            <td class="text-muted-foreground py-2 pr-4">false</td>
            <td class="py-2">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒåˆæœŸçŠ¶æ…‹ã§é–‹ã„ã¦ã„ã‚‹ã‹ã©ã†ã‹</td>
          </tr>
          <tr class="border-border border-b">
            <td class="py-2 pr-4"><code>class</code></td>
            <td class="text-muted-foreground py-2 pr-4">string</td>
            <td class="text-muted-foreground py-2 pr-4">''</td>
            <td class="py-2">ã‚³ãƒ³ãƒ†ãƒŠã®è¿½åŠ  CSS ã‚¯ãƒ©ã‚¹</td>
          </tr>
        </tbody>
      </table>
    </ResponsiveTable>

    <h3 class="mb-3 text-lg font-medium">ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ</h3>
    <ResponsiveTable class="mb-6">
      <table class="w-full border-collapse">
        <thead>
          <tr class="border-border border-b">
            <th class="py-2 pr-4 text-left">ã‚¤ãƒ™ãƒ³ãƒˆ</th>
            <th class="py-2 pr-4 text-left">Detail</th>
            <th class="py-2 text-left">èª¬æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-border border-b">
            <td class="py-2 pr-4"><code>itemselect</code></td>
            <td class="text-muted-foreground py-2 pr-4">{'{ itemId: string }'}</td>
            <td class="py-2">ãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›®ãŒé¸æŠã•ã‚ŒãŸã¨ãã«ç™ºè¡Œã•ã‚Œã‚‹</td>
          </tr>
        </tbody>
      </table>
    </ResponsiveTable>

    <h3 class="mb-3 text-lg font-medium">MenuItem Interface</h3>
    <CodeBlock
      code={`interface MenuItem {
  id: string;
  label: string;
  disabled?: boolean;
}`}
      lang="typescript"
      title="Types"
    />
  </section>

  <!-- Testing Section -->
  <section class="mb-12">
    <Heading level={2} id="testing" class="mb-4 text-xl font-semibold"
      >{t('pattern.testing')}</Heading
    >
    <TestingDocs />
  </section>

  <!-- Resources -->
  <section>
    <Heading level={2} id="resources" class="mb-4 text-xl font-semibold"
      >{t('pattern.resources')}</Heading
    >
    <ul class="list-disc space-y-2 pl-6">
      <li>
        <ExternalLink
          href="https://www.w3.org/WAI/ARIA/apg/patterns/menu-button/"
          class="text-primary hover:underline"
        >
          WAI-ARIA APG: Menu Button ãƒ‘ã‚¿ãƒ¼ãƒ³
        </ExternalLink>
      </li>
      <li>
        <ExternalLink href={withBase("/patterns/menu-button/llm.md")} class="text-primary hover:underline">
          AI Implementation Guide (llm.md)
        </ExternalLink>
        <span class="text-muted-foreground text-sm">
          - ARIA specs, keyboard support, test checklist</span
        >
      </li>
    </ul>
  </section>
</PatternLayout>
