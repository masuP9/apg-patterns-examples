---
// Dynamic redirect to user's preferred framework page
// This single file handles redirects for all patterns

import { FRAMEWORKS, DEFAULT_FRAMEWORK } from '@/lib/frameworks';
import { getPatterns } from '@/lib/patterns';
import { withBase } from '@/lib/utils';

export function getStaticPaths() {
  return getPatterns().map((p) => ({ params: { pattern: p.id } }));
}

const { pattern } = Astro.params;
const defaultFramework = DEFAULT_FRAMEWORK;
const validFrameworks = FRAMEWORKS;
const basePath = import.meta.env.BASE_URL.replace(/\/$/, '');
const defaultRedirectUrl = withBase(`/patterns/${pattern}/${defaultFramework}/`);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Redirecting...</title>
    <script is:inline define:vars={{ pattern, defaultFramework, validFrameworks, basePath }}>
      const framework = localStorage.getItem('apg-selected-framework') || defaultFramework;
      const selectedFramework = validFrameworks.includes(framework) ? framework : defaultFramework;
      window.location.replace(`${basePath}/patterns/${pattern}/${selectedFramework}/`);
    </script>
    <noscript>
      <meta http-equiv="refresh" content={`0;url=${defaultRedirectUrl}`} />
    </noscript>
  </head>
  <body>
    <p>Redirecting to <a href={defaultRedirectUrl}>{defaultFramework}</a>...</p>
  </body>
</html>
