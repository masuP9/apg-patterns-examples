---
import type { Locale } from '@/i18n';
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import { localize, createTableHeaderTranslator } from '@/lib/pattern-data/i18n';
import { alertDialogAccessibilityData, dialogVsAlertDialogDifferences } from './accessibility-data';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
const data = alertDialogAccessibilityData;
const t = localize(locale);
const th = createTableHeaderTranslator(locale);

// Section title for "Differences from Dialog"
const differencesTitle = locale === 'ja' ? 'Dialog との違い' : 'Differences from Dialog';
const notesTitle = locale === 'ja' ? '補足事項' : 'Additional Notes';

// Get comparison data
const comparison = dialogVsAlertDialogDifferences[locale];
---

<div class="prose dark:prose-invert max-w-none">
  <!-- WAI-ARIA Roles -->
  <h3 class="mb-3 text-lg font-medium">{th('section.ariaRoles')}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{th('table.role')}</th>
          <th class="py-2 pr-4 text-left">{th('table.element')}</th>
          <th class="py-2 text-left">{th('table.description')}</th>
        </tr>
      </thead>
      <tbody>
        {
          data.roles.map((role) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <code>{role.name}</code>
              </td>
              <td class="py-2 pr-4">{t(role.element)}</td>
              <td class="py-2">{t(role.description)}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>

  {
    data.references && data.references.length > 0 && (
      <p class="text-muted-foreground mb-6 text-sm">
        <ExternalLink href={data.references[0].url} class="text-primary hover:underline">
          {data.references[0].title}
        </ExternalLink>
      </p>
    )
  }

  <!-- WAI-ARIA Properties -->
  {
    data.properties && data.properties.length > 0 && (
      <>
        <h3 class="mb-3 text-lg font-medium">{th('section.ariaProperties')}</h3>
        <ResponsiveTable class="mb-6">
          <table class="w-full border-collapse">
            <thead>
              <tr class="border-border border-b">
                <th class="py-2 pr-4 text-left">{th('table.attribute')}</th>
                <th class="py-2 pr-4 text-left">{th('table.target')}</th>
                <th class="py-2 pr-4 text-left">{th('table.values')}</th>
                <th class="py-2 pr-4 text-left">{th('table.required')}</th>
                <th class="py-2 text-left">{th('table.description')}</th>
              </tr>
            </thead>
            <tbody>
              {data.properties.map((prop) => (
                <tr class="border-border border-b">
                  <td class="py-2 pr-4">
                    <code>{prop.attribute}</code>
                  </td>
                  <td class="py-2 pr-4">{t(prop.element)}</td>
                  <td class="py-2 pr-4">
                    {typeof prop.values === 'string' && prop.values.startsWith('<code>') ? (
                      <code>{prop.values.replace(/<\/?code>/g, '')}</code>
                    ) : (
                      t(prop.values)
                    )}
                  </td>
                  <td class="py-2 pr-4">
                    {typeof prop.required === 'boolean'
                      ? prop.required
                        ? th('value.yes')
                        : th('value.no')
                      : t(prop.required)}
                  </td>
                  <td class="py-2">{prop.notes && t(prop.notes)}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </ResponsiveTable>
      </>
    )
  }

  <!-- Focus Management -->
  {
    data.focusManagement && data.focusManagement.length > 0 && (
      <>
        <h3 class="mb-3 text-lg font-medium">{th('section.focusManagement')}</h3>
        <ResponsiveTable class="mb-6">
          <table class="w-full border-collapse">
            <thead>
              <tr class="border-border border-b">
                <th class="py-2 pr-4 text-left">{th('table.event')}</th>
                <th class="py-2 text-left">{th('table.behavior')}</th>
              </tr>
            </thead>
            <tbody>
              {data.focusManagement.map((rule) => (
                <tr class="border-border border-b">
                  <td class="py-2 pr-4">{t(rule.event)}</td>
                  <td class="py-2">{t(rule.behavior)}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </ResponsiveTable>
      </>
    )
  }

  <!-- Keyboard Support -->
  {
    data.keyboardSupport && data.keyboardSupport.length > 0 && (
      <>
        <h3 class="mb-3 text-lg font-medium">{th('section.keyboardSupport')}</h3>
        <ResponsiveTable class="mb-4">
          <table class="w-full border-collapse">
            <thead>
              <tr class="border-border border-b">
                <th class="py-2 pr-4 text-left">{th('table.key')}</th>
                <th class="py-2 text-left">{th('table.action')}</th>
              </tr>
            </thead>
            <tbody>
              {data.keyboardSupport.map((shortcut) => {
                const keyText = t(shortcut.key);
                return (
                  <tr class="border-border border-b">
                    <td class="py-2 pr-4">
                      {keyText.includes(' + ') ? (
                        keyText.split(' + ').map((k: string, i: number) => (
                          <>
                            {i > 0 && ' + '}
                            <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">{k}</kbd>
                          </>
                        ))
                      ) : (
                        <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">{keyText}</kbd>
                      )}
                    </td>
                    <td class="py-2">{t(shortcut.action)}</td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </ResponsiveTable>
      </>
    )
  }

  <!-- Differences from Dialog -->
  <h3 class="mb-3 text-lg font-medium">{differencesTitle}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{comparison.header.feature}</th>
          <th class="py-2 pr-4 text-left">{comparison.header.dialog}</th>
          <th class="py-2 text-left">{comparison.header.alertDialog}</th>
        </tr>
      </thead>
      <tbody>
        {
          comparison.rows.map((row) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">{row.feature}</td>
              <td class="py-2 pr-4">
                {row.dialog === 'dialog' || row.dialog === 'alertdialog' ? (
                  <code>{row.dialog}</code>
                ) : (
                  row.dialog
                )}
              </td>
              <td class="py-2">
                {row.alertDialog === 'dialog' || row.alertDialog === 'alertdialog' ? (
                  <code>{row.alertDialog}</code>
                ) : (
                  row.alertDialog
                )}
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>

  <!-- Additional Notes -->
  {
    data.additionalNotes && data.additionalNotes.length > 0 && (
      <>
        <h3 class="mb-3 text-lg font-medium">{notesTitle}</h3>
        <ul class="text-muted-foreground list-disc space-y-2 pl-6">
          {data.additionalNotes.map((note) => (
            <li set:html={t(note)} />
          ))}
        </ul>
      </>
    )
  }
</div>
