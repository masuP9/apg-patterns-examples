---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <div
    class="mb-6 rounded-lg border border-red-200 bg-red-50 p-4 dark:border-red-800 dark:bg-red-900/20"
  >
    <h3 class="mt-0 mb-2 text-lg font-semibold text-red-800 dark:text-red-200">
      Critical Implementation Note
    </h3>
    <p class="mb-2 text-sm text-red-800 dark:text-red-200">
      <strong
        >The live region container (<code>role="alert"</code>) must exist in the DOM from page load.</strong
      >
      Do NOT dynamically add/remove the container itself. Only the content inside the container should
      change dynamically.
    </p>
    <div class="text-sm text-red-700 dark:text-red-300">
      <pre
        class="mb-2 overflow-x-auto rounded-md bg-red-100 p-3 dark:bg-red-900/40"><code>{`// Incorrect: Dynamically adding live region
{showAlert && <div role="alert">Message</div>}

// Correct: Live region always exists, content changes
<div role="alert">
  {message && <span>{message}</span>}
</div>`}</code></pre>
      <p class="mt-2">
        Screen readers detect changes to live regions by observing DOM mutations inside them. If the
        live region itself is added dynamically, some screen readers may not announce the content
        reliably.
      </p>
    </div>
  </div>

  <h3 class="mb-3 text-lg font-medium">WAI-ARIA Roles</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <code>alert</code> - An element that displays a brief, important message that attracts the user's
      attention without interrupting their task<br />
      <ExternalLink
        href="https://w3c.github.io/aria/#alert"
        class="text-primary text-sm hover:underline"
      >
        WAI-ARIA alert role
      </ExternalLink>
    </li>
  </ul>

  <h3 class="mb-3 text-lg font-medium">Implicit ARIA Properties</h3>
  <p class="text-muted-foreground mb-4">
    The <code>role="alert"</code> implicitly sets the following ARIA properties. You do NOT need to add
    these manually:
  </p>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Property</th>
          <th class="py-2 pr-4 text-left">Implicit Value</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-live</code></td>
          <td class="py-2 pr-4"><code>assertive</code></td>
          <td class="py-2">Interrupts screen reader to announce immediately</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-atomic</code></td>
          <td class="py-2 pr-4"><code>true</code></td>
          <td class="py-2">Announces entire alert content, not just changed parts</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">Keyboard Support</h3>
  <div
    class="mb-6 rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-900/20"
  >
    <p class="text-sm text-blue-800 dark:text-blue-200">
      <strong>Alerts require no keyboard interaction.</strong> They are designed to inform users without
      interrupting their workflow. The alert content is automatically announced by screen readers when
      it changes.
    </p>
  </div>

  <p class="text-muted-foreground mb-4">
    If the alert includes a dismiss button, the button follows standard button keyboard interaction:
  </p>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Key</th>
          <th class="py-2 text-left">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"
            ><kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">Enter</kbd></td
          >
          <td class="py-2">Activates the dismiss button</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"
            ><kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">Space</kbd></td
          >
          <td class="py-2">Activates the dismiss button</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">Focus Management</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <strong>Alert must NOT move focus</strong> - Alerts are non-modal and should not interrupt user
      workflow by stealing focus.
    </li>
    <li>
      <strong>Alert container is not focusable</strong> - The alert element should not have <code
        >tabindex</code
      > or receive keyboard focus.
    </li>
    <li>
      <strong>Dismiss button is focusable</strong> - If present, the dismiss button can be reached via
      Tab navigation.
    </li>
  </ul>

  <h3 class="mb-3 text-lg font-medium">Important Guidelines</h3>

  <div class="mb-4">
    <h4 class="mb-2 font-medium">No Auto-Dismissal</h4>
    <p class="text-muted-foreground mb-2">
      Alerts should NOT disappear automatically. Per
      <ExternalLink
        href="https://www.w3.org/WAI/WCAG21/Understanding/no-timing.html"
        class="text-primary hover:underline"
      >
        WCAG 2.2.3 No Timing
      </ExternalLink>, users need sufficient time to read content. If auto-dismissal is required:
    </p>
    <ul class="text-muted-foreground list-disc pl-6">
      <li>Provide user control to pause/extend the display time</li>
      <li>Ensure sufficient display duration (minimum 5 seconds + reading time)</li>
      <li>Consider if the content is truly non-essential</li>
    </ul>
  </div>

  <div class="mb-4">
    <h4 class="mb-2 font-medium">Alert Frequency</h4>
    <p class="text-muted-foreground mb-2">
      Excessive alerts can inhibit usability, especially for users with visual or cognitive
      disabilities (<ExternalLink
        href="https://www.w3.org/WAI/WCAG21/Understanding/interruptions.html"
        class="text-primary hover:underline"
      >
        WCAG 2.2.4 Interruptions
      </ExternalLink>). Use alerts sparingly for truly important messages.
    </p>
  </div>

  <div class="mb-6">
    <h4 class="mb-2 font-medium">Alert vs Alert Dialog</h4>
    <p class="text-muted-foreground mb-2">
      Use <strong>Alert</strong> when:
    </p>
    <ul class="text-muted-foreground mb-2 list-disc pl-6">
      <li>The message is informational and doesn't require user action</li>
      <li>User workflow should NOT be interrupted</li>
      <li>Focus should remain on the current task</li>
    </ul>
    <p class="text-muted-foreground mb-2">
      Use <strong>Alert Dialog</strong> (<code>role="alertdialog"</code>) when:
    </p>
    <ul class="text-muted-foreground list-disc pl-6">
      <li>The message requires immediate user response</li>
      <li>User must acknowledge or take action before continuing</li>
      <li>Focus should move to the dialog (modal behavior)</li>
    </ul>
    <div
      class="mt-2 rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20"
    >
      <p class="text-sm text-amber-800 dark:text-amber-200">
        <strong>Note:</strong>
        <code>role="alertdialog"</code> requires focus management and keyboard handling (Escape to close,
        focus trapping). Only use it when modal interruption is appropriate.
      </p>
    </div>
  </div>

  <h3 class="mb-3 text-lg font-medium">Screen Reader Behavior</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <strong>Immediate announcement</strong> - When alert content changes, screen readers interrupt current
      reading to announce the alert (<code>aria-live="assertive"</code>).
    </li>
    <li>
      <strong>Full content announced</strong> - The entire alert content is read, not just the changed
      portion (<code>aria-atomic="true"</code>).
    </li>
    <li>
      <strong>Initial content not announced</strong> - Alerts that exist when the page loads are NOT automatically
      announced. Only dynamic changes trigger announcements.
    </li>
  </ul>

  <h3 class="mb-3 text-lg font-medium">References</h3>
  <ul class="list-disc space-y-2 pl-6">
    <li>
      <ExternalLink
        href="https://www.w3.org/WAI/ARIA/apg/patterns/alert/"
        class="text-primary hover:underline"
      >
        WAI-ARIA APG: Alert Pattern
      </ExternalLink>
    </li>
    <li>
      <ExternalLink href="https://w3c.github.io/aria/#alert" class="text-primary hover:underline">
        WAI-ARIA: alert role
      </ExternalLink>
    </li>
    <li>
      <ExternalLink
        href="https://www.w3.org/WAI/ARIA/apg/patterns/alertdialog/"
        class="text-primary hover:underline"
      >
        WAI-ARIA APG: Alert Dialog Pattern
      </ExternalLink>
    </li>
  </ul>
</div>
