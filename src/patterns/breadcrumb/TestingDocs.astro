---
import type { Locale } from '@/i18n';
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import { localize, createTableHeaderTranslator } from '@/lib/pattern-data/i18n';
import { breadcrumbAccessibilityData } from './accessibility-data';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
const testing = breadcrumbAccessibilityData.testing;
const t = localize(locale);
const th = createTableHeaderTranslator(locale);

// Section titles
const sectionTitles = {
  en: {
    intro:
      'Tests verify APG compliance across ARIA attributes, semantic structure, and accessibility requirements. The Breadcrumb component uses a two-layer testing strategy.',
    strategy: 'Testing Strategy',
    categories: 'Test Categories',
    tools: 'Testing Tools',
    docLink: 'for full documentation.',
  },
  ja: {
    intro:
      'テストはARIA属性、セマンティック構造、アクセシビリティ要件全体にわたってAPG準拠を検証します。Breadcrumbコンポーネントは2層のテスト戦略を採用しています。',
    strategy: 'テスト戦略',
    categories: 'テストカテゴリ',
    tools: 'テストツール',
    docLink: 'を参照してください。',
  },
};

const titles = sectionTitles[locale];

// Priority colors
const priorityColors: Record<string, string> = {
  high: 'bg-red-500',
  medium: 'bg-yellow-500',
  low: 'bg-green-500',
};

// Priority labels
const priorityLabels: Record<string, Record<string, string>> = {
  en: { high: 'High Priority', medium: 'Medium Priority', low: 'Low Priority' },
  ja: { high: '高優先度', medium: '中優先度', low: '低優先度' },
};
---

{
  testing && (
    <div class="prose dark:prose-invert max-w-none">
      <p class="text-muted-foreground mb-4">{titles.intro}</p>

      <h3 class="mb-3 text-lg font-medium">{titles.strategy}</h3>

      {testing.strategies.map((strategy) => (
        <div class="bg-muted/50 mb-6 rounded-lg p-4">
          <h4 class="mb-2 font-medium">{t(strategy.title)}</h4>
          <p class="text-muted-foreground mb-2 text-sm">{t(strategy.description)}</p>
          <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
            {strategy.areas.map((area) => (
              <li>{t(area)}</li>
            ))}
          </ul>
        </div>
      ))}

      <h3 class="mb-3 text-lg font-medium">{titles.categories}</h3>

      {testing.categories.map((category) => (
        <>
          <h4 class="mb-2 flex items-center gap-2 font-medium">
            <span
              class={`inline-block h-3 w-3 rounded-full ${priorityColors[category.priority]}`}
            />
            {priorityLabels[locale][category.priority]}: {t(category.title)}
          </h4>
          <ResponsiveTable class="mb-6">
            <table class="w-full border-collapse">
              <thead>
                <tr class="border-border border-b">
                  <th class="py-2 pr-4 text-left">{locale === 'ja' ? 'テスト' : 'Test'}</th>
                  <th class="py-2 text-left">{th('table.description')}</th>
                </tr>
              </thead>
              <tbody>
                {category.items.map((item) => (
                  <tr class="border-border border-b">
                    <td class="py-2 pr-4">
                      <code>{item.name}</code>
                    </td>
                    <td class="py-2" set:html={t(item.description)} />
                  </tr>
                ))}
              </tbody>
            </table>
          </ResponsiveTable>
        </>
      ))}

      <h3 class="mb-3 text-lg font-medium">{titles.tools}</h3>
      <ul class="mb-6 list-disc space-y-2 pl-6">
        {testing.tools.map((tool) => (
          <li>
            <ExternalLink href={tool.url} class="text-primary hover:underline">
              {tool.name}
            </ExternalLink>
            {' - '}
            {t(tool.description)}
          </li>
        ))}
      </ul>

      {testing.documentationLink && (
        <p class="text-muted-foreground text-sm">
          {locale === 'ja' ? '完全なドキュメントについては' : 'See '}
          <ExternalLink href={testing.documentationLink} class="text-primary hover:underline">
            testing-strategy.md
          </ExternalLink>
          {titles.docLink}
        </p>
      )}
    </div>
  )
}
