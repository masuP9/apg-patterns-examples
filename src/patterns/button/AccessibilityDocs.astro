---
import type { Locale } from '@/i18n';
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import { localize, createTableHeaderTranslator } from '@/lib/pattern-data/i18n';
import { buttonAccessibilityData } from './accessibility-data';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
const data = buttonAccessibilityData;
const t = localize(locale);
const th = createTableHeaderTranslator(locale);
---

<div class="prose dark:prose-invert max-w-none">
  <!-- WAI-ARIA Role -->
  <h3 class="mb-3 text-lg font-medium">{th('section.ariaRoles')}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{th('table.role')}</th>
          <th class="py-2 pr-4 text-left">{th('table.element')}</th>
          <th class="py-2 text-left">{th('table.description')}</th>
        </tr>
      </thead>
      <tbody>
        {
          data.roles.map((role) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <code>{role.name}</code>
              </td>
              <td class="py-2 pr-4">{t(role.element)}</td>
              <td class="py-2">
                <Fragment set:html={t(role.description)} />
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>
  <p class="text-muted-foreground mb-6 text-sm">
    {
      locale === 'ja'
        ? 'この実装は教育目的で <code>&lt;span role="button"&gt;</code> を使用しています。本番環境では、ネイティブの <code>&lt;button&gt;</code> 要素を優先してください。'
        : 'This implementation uses <code>&lt;span role="button"&gt;</code> for educational purposes. For production use, prefer native <code>&lt;button&gt;</code> elements.'
    }
  </p>

  <!-- WAI-ARIA Properties -->
  <h3 class="mb-3 text-lg font-medium">{th('section.ariaProperties')}</h3>

  {
    data.properties?.map((prop) => (
      <div class="mb-6">
        <h4 class="mb-2 font-medium">
          <code>{prop.attribute}</code>
          {prop.notes &&
            typeof prop.required === 'object' &&
            ' (' + t(prop.notes).split('.')[0] + ')'}
        </h4>
        {prop.notes && (
          <p class="text-muted-foreground mb-3">
            <Fragment set:html={t(prop.notes)} />
          </p>
        )}
        <ResponsiveTable class="mb-2">
          <table class="w-full border-collapse">
            <tbody>
              <tr class="border-border border-b">
                <td class="w-32 py-2 pr-4 font-medium">{th('table.values')}</td>
                <td class="py-2">{t(prop.values)}</td>
              </tr>
              <tr class="border-border border-b">
                <td class="py-2 pr-4 font-medium">{th('table.required')}</td>
                <td class="py-2">
                  {typeof prop.required === 'boolean'
                    ? prop.required
                      ? th('value.yes')
                      : th('value.no')
                    : t(prop.required)}
                </td>
              </tr>
            </tbody>
          </table>
        </ResponsiveTable>
      </div>
    ))
  }

  <!-- Keyboard Support -->
  <h3 class="mb-3 text-lg font-medium">{th('section.keyboardSupport')}</h3>
  <ResponsiveTable class="mb-4">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{th('table.key')}</th>
          <th class="py-2 text-left">{th('table.action')}</th>
        </tr>
      </thead>
      <tbody>
        {
          data.keyboardSupport?.map((shortcut) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">{shortcut.key}</kbd>
              </td>
              <td class="py-2">{t(shortcut.action)}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>
  {
    data.additionalNotes && data.additionalNotes[0] && (
      <p class="text-muted-foreground mb-6 text-sm">
        <Fragment set:html={t(data.additionalNotes[0])} />
      </p>
    )
  }

  <!-- Accessible Naming -->
  {
    data.accessibleNaming && (
      <>
        <h3 class="mb-3 text-lg font-medium">{th('section.accessibleNaming')}</h3>
        <p class="text-muted-foreground mb-3">
          {data.accessibleNaming.description ? t(data.accessibleNaming.description) : ''}
        </p>
        <ul class="mb-6 list-disc space-y-2 pl-6">
          {data.accessibleNaming.methods?.map((method) => (
            <li>
              <strong>{t(method.method)}</strong> - {t(method.description)}
            </li>
          ))}
        </ul>
      </>
    )
  }

  <!-- Focus Styles -->
  {
    data.focusManagement && data.focusManagement.length > 0 && (
      <>
        <h3 class="mb-3 text-lg font-medium">
          {locale === 'ja' ? 'フォーカススタイル' : 'Focus Styles'}
        </h3>
        <p class="text-muted-foreground mb-3">
          {locale === 'ja'
            ? 'この実装は明確なフォーカスインジケーターを提供します：'
            : 'This implementation provides clear focus indicators:'}
        </p>
        <ul class="mb-6 list-disc space-y-2 pl-6">
          {data.focusManagement.map((item) => (
            <li>
              <strong>{t(item.event)}</strong> - {t(item.behavior)}
            </li>
          ))}
        </ul>
      </>
    )
  }

  <!-- Button vs Toggle Button -->
  <h3 class="mb-3 text-lg font-medium">
    {locale === 'ja' ? 'Button と Toggle Button' : 'Button vs Toggle Button'}
  </h3>
  <p class="text-muted-foreground mb-3">
    {
      locale === 'ja' ? (
        <>
          このパターンは単純なアクションボタン用です。押された状態と押されていない状態を切り替えるボタンについては、
          <code>aria-pressed</code> を使用する{' '}
          <a href="/ja/patterns/toggle-button/react/" class="text-primary hover:underline">
            Toggle Button パターン
          </a>{' '}
          を参照してください。
        </>
      ) : (
        <>
          This pattern is for simple action buttons. For buttons that toggle between pressed and
          unpressed states, see the{' '}
          <a href="/patterns/toggle-button/react/" class="text-primary hover:underline">
            Toggle Button pattern
          </a>{' '}
          which uses <code>aria-pressed</code>.
        </>
      )
    }
  </p>

  <!-- References -->
  {
    data.references && data.references.length > 0 && (
      <>
        <h3 class="mb-3 text-lg font-medium">{th('section.references')}</h3>
        <ul class="list-disc space-y-2 pl-6">
          {data.references.map((ref) => (
            <li>
              <ExternalLink href={ref.url} class="text-primary hover:underline">
                {ref.title}
              </ExternalLink>
            </li>
          ))}
        </ul>
      </>
    )
  }
</div>
