---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    テストは、キーボード操作、ARIA属性、アクセシビリティ要件全体にわたってAPG準拠を検証します。
    Buttonコンポーネントは2層のテスト戦略を採用しています。
  </p>

  <h3 class="mb-3 text-lg font-medium">テスト戦略</h3>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">ユニットテスト（Testing Library）</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      フレームワーク固有のテストライブラリを使用してコンポーネントのレンダリング出力を検証します。これらのテストは正しいHTML構造とARIA属性を確認します。
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>ARIA属性（role="button"、tabindex）</li>
      <li>キーボード操作（SpaceキーとEnterキーでのアクティブ化）</li>
      <li>無効状態の処理</li>
      <li>jest-axeによるアクセシビリティ検証</li>
    </ul>
  </div>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">E2Eテスト（Playwright）</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      すべてのフレームワークで実際のブラウザ環境でコンポーネントの動作を検証します。これらのテストはインタラクションとフレームワーク間の一貫性をカバーします。
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>ライブブラウザでのARIA構造</li>
      <li>キーボードでのアクティブ化（SpaceキーとEnterキー）</li>
      <li>クリック操作の動作</li>
      <li>無効状態のインタラクション</li>
      <li>axe-coreによるアクセシビリティスキャン</li>
      <li>フレームワーク間の一貫性チェック</li>
    </ul>
  </div>

  <h3 class="mb-3 text-lg font-medium">テストカテゴリ</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: APGキーボード操作（Unit + E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Space key</code></td>
          <td class="py-2">ボタンをアクティブ化</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Enter key</code></td>
          <td class="py-2">ボタンをアクティブ化</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Space preventDefault</code></td>
          <td class="py-2">Spaceキー押下時のページスクロールを防止</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>IME composing</code></td>
          <td class="py-2">IME入力中はSpace/Enterキーを無視</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Tab navigation</code></td>
          <td class="py-2">Tabキーでボタン間のフォーカスを移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Disabled Tab skip</code></td>
          <td class="py-2">無効なボタンはTabオーダーでスキップされる</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>
  <p class="text-muted-foreground mb-6 text-sm">
    <strong>重要:</strong> SpaceキーとEnterキーの両方がボタンをアクティブ化します。これはEnterキーのみに応答するリンクとは異なります。
    カスタム実装では、ページスクロールを防止するためにSpaceキーで <code>event.preventDefault()</code
    > を呼び出す必要があります。
  </p>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: ARIA属性（Unit + E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="button"</code></td>
          <td class="py-2">要素がbuttonロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex="0"</code></td>
          <td class="py-2">要素がキーボードでフォーカス可能</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-disabled</code></td>
          <td class="py-2">無効時に "true" に設定</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex="-1"</code></td>
          <td class="py-2">無効時にTabオーダーから除外するために設定</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Accessible name</code></td>
          <td class="py-2">テキストコンテンツ、aria-label、またはaria-labelledbyから名前を取得</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: クリック動作（Unit + E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Click activation</code></td>
          <td class="py-2">クリックでボタンがアクティブ化される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Disabled click</code></td>
          <td class="py-2">無効なボタンはクリックイベントを無視</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Disabled Space</code></td>
          <td class="py-2">無効なボタンはSpaceキーを無視</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Disabled Enter</code></td>
          <td class="py-2">無効なボタンはEnterキーを無視</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: アクセシビリティ（Unit + E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe violations</code></td>
          <td class="py-2">WCAG 2.1 AAの違反がない（jest-axeによる）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>disabled axe</code></td>
          <td class="py-2">無効状態での違反がない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-label axe</code></td>
          <td class="py-2">aria-label使用時の違反がない</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-green-500"></span>
    低優先度: プロパティ & 属性（Unit）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>className</code></td>
          <td class="py-2">カスタムクラスが適用される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>data-* attributes</code></td>
          <td class="py-2">カスタムdata属性が渡される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>children</code></td>
          <td class="py-2">子コンテンツがレンダリングされる</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-green-500"></span>
    低優先度: フレームワーク間の一貫性（E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>すべてのフレームワークにボタンがある</code></td>
          <td class="py-2">React、Vue、Svelte、Astroすべてがカスタムボタン要素をレンダリング</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>同じボタン数</code></td>
          <td class="py-2">すべてのフレームワークで同じ数のボタンをレンダリング</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>一貫したARIA</code></td>
          <td class="py-2">すべてのフレームワークで一貫したARIA構造</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">テストツール</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <ExternalLink href="https://vitest.dev/" class="text-primary hover:underline"
        >Vitest</ExternalLink
      >
      - ユニットテストランナー
    </li>
    <li>
      <ExternalLink href="https://testing-library.com/" class="text-primary hover:underline"
        >Testing Library</ExternalLink
      >
      - フレームワーク別テストユーティリティ（React、Vue、Svelte）
    </li>
    <li>
      <ExternalLink href="https://playwright.dev/" class="text-primary hover:underline"
        >Playwright</ExternalLink
      >
      - E2Eテスト用ブラウザ自動化
    </li>
    <li>
      <ExternalLink
        href="https://github.com/dequelabs/axe-core-npm/tree/develop/packages/playwright"
        class="text-primary hover:underline">axe-core/playwright</ExternalLink
      >
      - E2Eでの自動アクセシビリティテスト
    </li>
  </ul>

  <p class="text-muted-foreground text-sm">
    詳細なドキュメントは <ExternalLink
      href="https://github.com/masuP9/apg-patterns-examples/blob/main/.internal/testing-strategy.md"
      class="text-primary hover:underline">testing-strategy.md</ExternalLink
    > を参照してください。
  </p>
</div>
