---
import { ResponsiveTable } from '@/components/ui/table';
import type { Locale } from '@/i18n';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;

// Translations
const t = {
  title: {
    en: 'Consider Native HTML First',
    ja: 'まずネイティブ HTML を検討してください',
  },
  description: {
    en: 'Before using a custom combobox, consider native HTML alternatives.',
    ja: 'カスタムコンボボックスを使用する前に、ネイティブ HTML の代替手段を検討してください。',
  },
  support: {
    en: 'They provide built-in semantics, work without JavaScript, and have native browser support.',
    ja: 'これらは組み込みのセマンティクスを持ち、JavaScript なしで動作し、ブラウザネイティブのサポートがあります。',
  },
  useCustomNote: {
    en: 'Use a custom combobox only when you need: custom styling, complex filtering logic, rich option rendering, or behaviors not supported by native elements.',
    ja: 'カスタムスタイル、複雑なフィルタリングロジック、リッチなオプション表示、またはネイティブ要素でサポートされていない動作が必要な場合にのみカスタムコンボボックスを使用してください。',
  },
  useCase: { en: 'Use Case', ja: 'ユースケース' },
  nativeHtml: { en: 'Native HTML', ja: 'ネイティブ HTML' },
  customImpl: { en: 'Custom Implementation', ja: 'カスタム実装' },
  nativeNote: {
    en: 'The native <code>&lt;select&gt;</code> element provides excellent accessibility, form submission support, and works without JavaScript. The <code>&lt;datalist&gt;</code> element provides basic autocomplete functionality, but its appearance varies significantly across browsers and lacks support for disabled options or custom rendering.',
    ja: 'ネイティブ <code>&lt;select&gt;</code> 要素は優れたアクセシビリティ、フォーム送信サポート、JavaScript 不要で動作します。<code>&lt;datalist&gt;</code> 要素は基本的なオートコンプリート機能を提供しますが、ブラウザ間で見た目が大きく異なり、無効なオプションやカスタム表示には対応していません。',
  },
  a11yWarningTitle: {
    en: 'Accessibility Concerns with <datalist>',
    ja: '<datalist> のアクセシビリティ上の問題',
  },
  a11yWarningIntro: {
    en: 'The <code>&lt;datalist&gt;</code> element has several known accessibility issues:',
    ja: '<code>&lt;datalist&gt;</code> 要素には、以下のアクセシビリティ上の問題が知られています：',
  },
  source: { en: 'Source:', ja: '出典:' },
};

// Use cases table data
const useCases = [
  {
    useCase: { en: 'Simple dropdown selection', ja: 'シンプルなドロップダウン選択' },
    native: { en: '<select> Recommended', ja: '<select> 推奨' },
    nativeIsGood: true,
    custom: { en: 'Not needed', ja: '不要' },
  },
  {
    useCase: { en: 'Basic autocomplete suggestions', ja: '基本的なオートコンプリート候補' },
    native: { en: '<datalist> Recommended', ja: '<datalist> 推奨' },
    nativeIsGood: true,
    custom: { en: 'Not needed', ja: '不要' },
  },
  {
    useCase: { en: 'JavaScript disabled support', ja: 'JavaScript 無効時のサポート' },
    native: { en: 'Works natively', ja: 'ネイティブで動作' },
    nativeIsGood: true,
    custom: { en: 'Requires fallback', ja: 'フォールバックが必要' },
  },
  {
    useCase: {
      en: 'Custom option rendering (icons, descriptions)',
      ja: 'カスタムオプション表示（アイコン、説明）',
    },
    native: { en: 'Not supported', ja: '非対応' },
    nativeIsGood: false,
    custom: { en: 'Full control', ja: '完全制御可能' },
    customIsGood: true,
  },
  {
    useCase: { en: 'Custom filtering logic', ja: 'カスタムフィルタリングロジック' },
    native: { en: 'Basic prefix matching', ja: '基本的な前方一致のみ' },
    nativeIsGood: false,
    custom: { en: 'Custom algorithms', ja: 'カスタムアルゴリズム' },
    customIsGood: true,
  },
  {
    useCase: { en: 'Consistent cross-browser styling', ja: 'ブラウザ間で一貫したスタイル' },
    native: { en: 'Limited (especially datalist)', ja: '限定的（特に datalist）' },
    nativeIsGood: false,
    custom: { en: 'Full control', ja: '完全制御可能' },
    customIsGood: true,
  },
  {
    useCase: {
      en: 'Keyboard navigation customization',
      ja: 'キーボードナビゲーションのカスタマイズ',
    },
    native: { en: 'Browser defaults only', ja: 'ブラウザデフォルトのみ' },
    nativeIsGood: false,
    custom: { en: 'Customizable', ja: 'カスタマイズ可能' },
    customIsGood: true,
  },
  {
    useCase: { en: 'Disabled options', ja: '無効なオプション' },
    native: { en: '<select> only', ja: '<select> のみ' },
    nativeIsGood: true,
    custom: { en: 'Fully supported', ja: '完全対応' },
    customIsGood: true,
  },
];

// Accessibility issues
const a11yIssues = [
  {
    strong: { en: 'Text zoom not supported:', ja: 'テキストズーム非対応：' },
    text: {
      en: 'The font size of datalist options does not scale when users zoom the page, creating issues for users who rely on text magnification.',
      ja: 'datalist のオプションのフォントサイズはページをズームしても拡大されず、テキスト拡大に依存するユーザーに問題を引き起こします。',
    },
  },
  {
    strong: { en: 'Limited CSS styling:', ja: 'CSS スタイリングの制限：' },
    text: {
      en: 'Options cannot be styled for high-contrast mode, preventing accommodation of users with visual impairments.',
      ja: 'オプションをハイコントラストモード向けにスタイリングできないため、視覚障害のあるユーザーへの対応が困難です。',
    },
  },
  {
    strong: { en: 'Screen reader compatibility:', ja: 'スクリーンリーダーの互換性：' },
    text: {
      en: 'Some screen reader and browser combinations (e.g., NVDA with Firefox) do not announce the contents of the autosuggest popup.',
      ja: '一部のスクリーンリーダーとブラウザの組み合わせ（例：NVDA と Firefox）では、オートサジェストポップアップの内容が読み上げられません。',
    },
  },
];

// Code examples
const codeExample =
  locale === 'ja'
    ? `<!-- シンプルなドロップダウン選択 -->
<label for="fruit">フルーツを選択</label>
<select id="fruit">
  <option value="apple">りんご</option>
  <option value="banana">バナナ</option>
</select>

<!-- 基本的なオートコンプリート -->
<label for="browser">ブラウザを選択</label>
<input list="browsers" id="browser" name="browser">
<datalist id="browsers">
  <option value="Chrome">
  <option value="Firefox">
  <option value="Safari">
</datalist>`
    : `<!-- For simple dropdown selection -->
<label for="fruit">Choose a fruit</label>
<select id="fruit">
  <option value="apple">Apple</option>
  <option value="banana">Banana</option>
</select>

<!-- For basic autocomplete -->
<label for="browser">Choose your browser</label>
<input list="browsers" id="browser" name="browser">
<datalist id="browsers">
  <option value="Chrome">
  <option value="Firefox">
  <option value="Safari">
</datalist>`;
---

<div class="border-primary mb-8 rounded-lg border-2 p-4">
  <h2 class="mb-2 flex items-center gap-2 text-lg font-bold">
    <span aria-hidden="true">⚠️</span>
    {t.title[locale]}
  </h2>
  <p class="mb-4">
    <strong class="text-red-700 dark:text-red-400">
      {t.description[locale]}
    </strong>
    {t.support[locale]}
  </p>
  <div class="bg-muted mb-4 rounded-md p-3">
    <pre class="m-0 overflow-x-auto text-sm"><code>{codeExample}</code></pre>
  </div>
  <p class="mb-4 text-sm">
    {t.useCustomNote[locale]}
  </p>

  <ResponsiveTable>
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{t.useCase[locale]}</th>
          <th class="py-2 pr-4 text-left">{t.nativeHtml[locale]}</th>
          <th class="py-2 text-left">{t.customImpl[locale]}</th>
        </tr>
      </thead>
      <tbody>
        {
          useCases.map((row) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">{row.useCase[locale]}</td>
              <td class="py-2 pr-4">
                {row.nativeIsGood ? (
                  <b class="text-green-700 dark:text-green-400">{row.native[locale]}</b>
                ) : (
                  row.native[locale]
                )}
              </td>
              <td class="py-2">
                {row.customIsGood ? (
                  <b class="text-green-700 dark:text-green-400">{row.custom[locale]}</b>
                ) : (
                  row.custom[locale]
                )}
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>
  <p class="text-muted-foreground mt-3 text-xs" set:html={t.nativeNote[locale]} />

  <div
    class="mt-4 rounded-md border border-amber-300 bg-amber-50 p-3 dark:border-amber-700 dark:bg-amber-950"
  >
    <h3 class="mb-2 flex items-center gap-2 text-sm font-bold text-amber-800 dark:text-amber-200">
      <span aria-hidden="true">⚠️</span>
      <span set:html={t.a11yWarningTitle[locale]} />
    </h3>
    <p
      class="mb-2 text-sm text-amber-900 dark:text-amber-100"
      set:html={t.a11yWarningIntro[locale]}
    />
    <ul class="mb-2 list-inside list-disc space-y-1 text-sm text-amber-900 dark:text-amber-100">
      {
        a11yIssues.map((issue) => (
          <li>
            <strong>{issue.strong[locale]}</strong>
            {issue.text[locale]}
          </li>
        ))
      }
    </ul>
    <p class="text-xs text-amber-700 dark:text-amber-300">
      {t.source[locale]}
      <a
        href="https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/datalist#accessibility"
        target="_blank"
        rel="noopener noreferrer"
        class="underline hover:no-underline"
      >
        MDN Web Docs - &lt;datalist&gt;: Accessibility
      </a>
    </p>
  </div>
</div>
