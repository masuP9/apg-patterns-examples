---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    テストは ARIA 属性、キーボード操作、フィルタリング動作、アクセシビリティ要件に対する APG
    準拠を検証します。
  </p>

  <h3 class="mb-3 text-lg font-medium">テストカテゴリ</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: ARIA 属性
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="combobox"</code></td>
          <td class="py-2">Input 要素に combobox ロールがある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="listbox"</code></td>
          <td class="py-2">ポップアップ要素に listbox ロールがある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="option"</code></td>
          <td class="py-2">各オプションに option ロールがある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-controls</code></td>
          <td class="py-2">Input が listbox ID を参照（常に存在）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-expanded</code></td>
          <td class="py-2">ポップアップの開閉状態を反映</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-autocomplete</code></td>
          <td class="py-2">"list"、"none"、"both" のいずれかに設定</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-activedescendant</code></td>
          <td class="py-2">現在フォーカスされているオプションを参照</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-selected</code></td>
          <td class="py-2">現在ハイライトされているオプションを示す</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-disabled</code></td>
          <td class="py-2">無効なオプションを示す</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: アクセシブル名
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-labelledby</code></td>
          <td class="py-2">Input が可視ラベル要素を参照</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-labelledby (listbox)</code></td>
          <td class="py-2">Listbox もラベルを参照</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: キーボード操作（ポップアップ閉時）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Down Arrow</code></td>
          <td class="py-2">ポップアップを開き、最初のオプションにフォーカス</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Up Arrow</code></td>
          <td class="py-2">ポップアップを開き、最後のオプションにフォーカス</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Alt + Down Arrow</code></td>
          <td class="py-2">フォーカスを変更せずにポップアップを開く</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>入力</code></td>
          <td class="py-2">ポップアップを開き、オプションをフィルタリング</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: キーボード操作（ポップアップ開時）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Down Arrow</code></td>
          <td class="py-2">次の有効なオプションに移動（折り返しなし）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Up Arrow</code></td>
          <td class="py-2">前の有効なオプションに移動（折り返しなし）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Home</code></td>
          <td class="py-2">最初の有効なオプションに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>End</code></td>
          <td class="py-2">最後の有効なオプションに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Enter</code></td>
          <td class="py-2">フォーカス中のオプションを選択しポップアップを閉じる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Escape</code></td>
          <td class="py-2">ポップアップを閉じ、以前の値を復元</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Alt + Up Arrow</code></td>
          <td class="py-2">フォーカス中のオプションを選択しポップアップを閉じる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Tab</code></td>
          <td class="py-2">ポップアップを閉じ、次のフォーカス可能な要素に移動</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: フォーカス管理
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Input に DOM フォーカス</code></td>
          <td class="py-2">DOM フォーカスは常に input に留まる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-activedescendant による仮想フォーカス</code></td>
          <td class="py-2">視覚的フォーカスは aria-activedescendant で制御</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>閉じた時にクリア</code></td>
          <td class="py-2">ポップアップが閉じると aria-activedescendant がクリア</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>無効なオプションをスキップ</code></td>
          <td class="py-2">ナビゲーションが無効なオプションをスキップ</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: フィルタリング
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>入力時にフィルタ</code></td>
          <td class="py-2">ユーザーが入力するとオプションがフィルタリング</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>大文字小文字を区別しない</code></td>
          <td class="py-2">フィルタリングは大文字小文字を区別しない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>フィルタなし (autocomplete="none")</code></td>
          <td class="py-2">入力に関係なくすべてのオプションを表示</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>空の結果</code></td>
          <td class="py-2">一致がない場合 aria-activedescendant がクリア</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: マウス操作
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>オプションをクリック</code></td>
          <td class="py-2">オプションを選択しポップアップを閉じる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>オプションにホバー</code></td>
          <td class="py-2">ホバー時に aria-activedescendant を更新</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>無効なオプションをクリック</code></td>
          <td class="py-2">無効なオプションは選択不可</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>外側をクリック</code></td>
          <td class="py-2">選択せずにポップアップを閉じる</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: IME 入力
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>変換中</code></td>
          <td class="py-2">IME 変換中はキーボードナビゲーションをブロック</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>変換完了時</code></td>
          <td class="py-2">変換完了後にフィルタリングを更新</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: コールバック
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>onSelect</code></td>
          <td class="py-2">選択時にオプションデータと共に呼び出し</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>onInputChange</code></td>
          <td class="py-2">入力値の変更時に呼び出し</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>onOpenChange</code></td>
          <td class="py-2">ポップアップの開閉時に呼び出し</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-green-500"></span>
    低優先度: HTML 属性継承
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>className</code></td>
          <td class="py-2">コンテナにカスタムクラスが適用される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>placeholder</code></td>
          <td class="py-2">プレースホルダーテキストが input に表示</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>disabled 状態</code></td>
          <td class="py-2">disabled prop が設定されるとコンポーネントが無効化</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">テストツール</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <strong>React:</strong>
      <ExternalLink
        href="https://testing-library.com/docs/react-testing-library/intro/"
        class="text-primary hover:underline"
      >
        React Testing Library
      </ExternalLink>
    </li>
    <li>
      <strong>Vue:</strong>
      <ExternalLink
        href="https://testing-library.com/docs/vue-testing-library/intro/"
        class="text-primary hover:underline"
      >
        Vue Testing Library
      </ExternalLink>
    </li>
    <li>
      <strong>Svelte:</strong>
      <ExternalLink
        href="https://testing-library.com/docs/svelte-testing-library/intro/"
        class="text-primary hover:underline"
      >
        Svelte Testing Library
      </ExternalLink>
    </li>
    <li>
      <strong>Astro:</strong> Web Component ユニットテスト用の Vitest + JSDOM
    </li>
    <li>
      <strong>アクセシビリティ:</strong>
      <ExternalLink
        href="https://github.com/dequelabs/axe-core"
        class="text-primary hover:underline"
      >
        axe-core
      </ExternalLink>
    </li>
  </ul>
</div>
