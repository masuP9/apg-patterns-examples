---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import { dialogAccessibilityData } from './accessibility-data';
import { localize, createTableHeaderTranslator } from '@/lib/pattern-data/i18n';
import type { Locale } from '@/i18n';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;

const { roles, properties, focusManagement, keyboardSupport, references, additionalNotes } =
  dialogAccessibilityData;

// Create localization function
const t = localize(locale);
const h = createTableHeaderTranslator(locale);
---

<div class="prose dark:prose-invert max-w-none">
  <h3 class="mb-3 text-lg font-medium">{h('section.ariaRoles')}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{h('table.role')}</th>
          <th class="py-2 pr-4 text-left">{h('table.element')}</th>
          <th class="py-2 text-left">{h('table.description')}</th>
        </tr>
      </thead>
      <tbody>
        {
          roles?.map((role) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <code>{role.name}</code>
              </td>
              <td class="py-2 pr-4">{t(role.element)}</td>
              <td class="py-2">{t(role.description)}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>
  {
    references && references[0] && (
      <p class="text-muted-foreground mb-6 text-sm">
        <ExternalLink href={references[0].url} class="text-primary hover:underline">
          {references[0].title}
        </ExternalLink>
      </p>
    )
  }

  <h3 class="mb-3 text-lg font-medium">{h('section.ariaProperties')}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{h('table.attribute')}</th>
          <th class="py-2 pr-4 text-left">{h('table.element')}</th>
          <th class="py-2 pr-4 text-left">{h('table.values')}</th>
          <th class="py-2 pr-4 text-left">{h('table.required')}</th>
          <th class="py-2 text-left">{h('table.description')}</th>
        </tr>
      </thead>
      <tbody>
        {
          properties?.map((prop) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <code>{prop.attribute}</code>
              </td>
              <td class="py-2 pr-4">{t(prop.element)}</td>
              <td class="py-2 pr-4">{t(prop.values)}</td>
              <td class="py-2 pr-4">
                {typeof prop.required === 'boolean'
                  ? prop.required
                    ? h('value.yes')
                    : h('value.no')
                  : t(prop.required)}
              </td>
              <td class="py-2">{prop.notes ? t(prop.notes) : ''}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">{h('section.focusManagement')}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{h('table.event')}</th>
          <th class="py-2 text-left">{h('table.behavior')}</th>
        </tr>
      </thead>
      <tbody>
        {
          focusManagement?.map((rule) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">{t(rule.event)}</td>
              <td class="py-2">{t(rule.behavior)}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">{h('section.keyboardSupport')}</h3>
  <ResponsiveTable class="mb-4">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{h('table.key')}</th>
          <th class="py-2 text-left">{h('table.action')}</th>
        </tr>
      </thead>
      <tbody>
        {
          keyboardSupport?.map((shortcut) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                {t(shortcut.key)
                  .split(' + ')
                  .map((k, i, arr) => (
                    <>
                      <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">{k}</kbd>
                      {i < arr.length - 1 && ' + '}
                    </>
                  ))}
              </td>
              <td class="py-2">{t(shortcut.action)}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">{h('section.additionalNotes')}</h3>
  <ul class="text-muted-foreground list-disc space-y-2 pl-6">
    {additionalNotes?.map((note) => <li>{t(note)}</li>)}
  </ul>
</div>
