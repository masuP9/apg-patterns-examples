---
import { ResponsiveTable } from '@/components/ui/table';
import { disclosureAccessibilityData } from './accessibility-data';
import type { Locale } from '@/i18n';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;

const { nativeVsCustom } = disclosureAccessibilityData;

// Section titles
const sectionTitles = {
  en: {
    title: 'Use Native HTML First',
    description:
      'Before using this custom component, consider using native <details> and <summary> elements.',
    descriptionEnd:
      'They provide built-in accessibility, work without JavaScript, and require no ARIA attributes.',
    customUsage:
      'Use custom implementations only when you need smooth height animations, external state control, or styling that native elements cannot provide.',
    useCase: 'Use Case',
    nativeHtml: 'Native HTML',
    customImplementation: 'Custom Implementation',
    recommended: 'Recommended',
    notNeeded: 'Not needed',
    worksNatively: 'Works natively',
    requiresFallback: 'Requires fallback',
    limitedSupport: 'Limited support',
    fullControl: 'Full control',
    limited: 'Limited',
    browserDependent: 'Browser-dependent',
  },
  ja: {
    title: 'ネイティブ HTML を優先',
    description:
      'このカスタムコンポーネントを使用する前に、ネイティブの <details> と <summary> 要素の使用を検討してください。',
    descriptionEnd:
      'ネイティブ要素は組み込みのアクセシビリティを提供し、JavaScript なしで動作し、ARIA 属性を必要としません。',
    customUsage:
      'カスタム実装は、滑らかな高さアニメーション、外部状態制御、またはネイティブ要素では提供できないスタイリングが必要な場合にのみ使用してください。',
    useCase: 'ユースケース',
    nativeHtml: 'ネイティブ HTML',
    customImplementation: 'カスタム実装',
    recommended: '推奨',
    notNeeded: '不要',
    worksNatively: 'ネイティブで動作',
    requiresFallback: 'フォールバックが必要',
    limitedSupport: '限定的なサポート',
    fullControl: '完全に制御可能',
    limited: '制限あり',
    browserDependent: 'ブラウザ依存',
  },
};

const titles = sectionTitles[locale];

// Translate native vs custom table values
const translateValue = (value: string): string => {
  const translations: Record<string, string> = {
    Recommended: titles.recommended,
    'Not needed': titles.notNeeded,
    'Works natively': titles.worksNatively,
    'Requires fallback': titles.requiresFallback,
    'Limited support': titles.limitedSupport,
    'Full control': titles.fullControl,
    Limited: titles.limited,
    'Browser-dependent': titles.browserDependent,
  };
  return translations[value] || value;
};

// Translate use case names
const translateUseCase = (useCase: string): string => {
  if (locale === 'ja') {
    const translations: Record<string, string> = {
      'Simple toggle content': 'シンプルなトグルコンテンツ',
      'JavaScript disabled support': 'JavaScript 無効時のサポート',
      'Smooth animations': '滑らかなアニメーション',
      'External state control': '外部状態制御',
      'Custom styling': 'カスタムスタイリング',
    };
    return translations[useCase] || useCase;
  }
  return useCase;
};

// Check if value is a "good" value (green highlight)
const isGoodValue = (value: string): boolean => {
  return ['Recommended', 'Works natively', 'Full control'].includes(value);
};
---

<div class="border-primary mb-8 rounded-lg border-2 p-4">
  <h2 class="mb-2 flex items-center gap-2 text-lg font-bold">
    <span aria-hidden="true">⚠️</span>
    {titles.title}
  </h2>
  <p class="mb-4">
    <strong class="text-red-700 dark:text-red-400">{titles.description}</strong>
    {titles.descriptionEnd}
  </p>
  <div class="bg-muted mb-4 rounded-md p-3">
    <pre
      class="m-0 overflow-x-auto text-sm"><code>&lt;details&gt;
  &lt;summary&gt;Show details&lt;/summary&gt;
  &lt;p&gt;Hidden content here...&lt;/p&gt;
&lt;/details&gt;</code></pre>
  </div>
  <p class="mb-4 text-sm">
    {titles.customUsage}
  </p>

  {
    nativeVsCustom && nativeVsCustom.length > 0 && (
      <ResponsiveTable>
        <table class="w-full border-collapse">
          <thead>
            <tr class="border-border border-b">
              <th class="py-2 pr-4 text-left">{titles.useCase}</th>
              <th class="py-2 pr-4 text-left">{titles.nativeHtml}</th>
              <th class="py-2 text-left">{titles.customImplementation}</th>
            </tr>
          </thead>
          <tbody>
            {nativeVsCustom.map((row) => (
              <tr class="border-border border-b">
                <td class="py-2 pr-4">{translateUseCase(row.feature)}</td>
                <td class="py-2 pr-4">
                  {isGoodValue(row.native) ? (
                    <b class="text-green-700 dark:text-green-400">{translateValue(row.native)}</b>
                  ) : (
                    translateValue(row.native)
                  )}
                </td>
                <td class="py-2">
                  {isGoodValue(row.custom) ? (
                    <b class="text-green-700 dark:text-green-400">{translateValue(row.custom)}</b>
                  ) : (
                    translateValue(row.custom)
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </ResponsiveTable>
    )
  }
</div>
