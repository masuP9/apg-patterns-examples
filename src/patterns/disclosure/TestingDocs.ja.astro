---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    テストは、キーボード操作、ARIA属性、アクセシビリティ要件の観点からAPG準拠を検証します。Disclosureコンポーネントは4つのフレームワーク全体でE2Eテストを使用しています。
  </p>

  <h3 class="mb-3 text-lg font-medium">テスト戦略</h3>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">E2Eテスト (Playwright)</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      4つのフレームワーク全体で実際のブラウザ環境でのコンポーネント動作を検証します。フルブラウザコンテキストが必要なインタラクションをカバーします。
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>キーボード操作（Space、Enter）</li>
      <li>aria-expanded状態の切り替え</li>
      <li>aria-controlsによるパネル関連付け</li>
      <li>パネル表示の同期</li>
      <li>無効状態の動作</li>
      <li>フォーカス管理とTabナビゲーション</li>
      <li>クロスフレームワーク一貫性</li>
    </ul>
  </div>

  <h3 class="mb-3 text-lg font-medium">テストカテゴリ</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: APG ARIA構造（E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>button要素</code></td>
          <td class="py-2">トリガーがセマンティックな<code>&lt;button&gt;</code>要素である</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-expanded</code></td>
          <td class="py-2">ボタンが<code>aria-expanded</code>属性を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-controls</code></td>
          <td class="py-2">ボタンが<code>aria-controls</code>でパネルIDを参照</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>アクセシブル名</code></td>
          <td class="py-2">ボタンがコンテンツまたはaria-labelからアクセシブルな名前を持つ</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: APGキーボード操作（E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Spaceキーでトグル</code></td>
          <td class="py-2">Spaceキーを押すとDisclosureの状態が切り替わる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Enterキーでトグル</code></td>
          <td class="py-2">Enterキーを押すとDisclosureの状態が切り替わる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Tabナビゲーション</code></td>
          <td class="py-2">Tabキーでフォーカスをボタンに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>無効時のTabスキップ</code></td>
          <td class="py-2">無効化されたDisclosureはTabの順序でスキップされる</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: 状態の同期（E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-expandedトグル</code></td>
          <td class="py-2">クリックで<code>aria-expanded</code>値が変わる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>パネル表示</code></td>
          <td class="py-2">パネルの表示が<code>aria-expanded</code>状態と一致</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>折りたたみ時は非表示</code></td>
          <td class="py-2">折りたたみ時にパネルコンテンツが非表示</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>展開時は表示</code></td>
          <td class="py-2">展開時にパネルコンテンツが表示</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: 無効状態（E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>disabled属性</code></td>
          <td class="py-2">無効なDisclosureが<code>disabled</code>属性を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>クリック無効</code></td>
          <td class="py-2">無効なDisclosureはクリックでトグルしない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>キーボード無効</code></td>
          <td class="py-2">無効なDisclosureはキーボードでトグルしない</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: アクセシビリティ（E2E）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe（折りたたみ時）</code></td>
          <td class="py-2">折りたたみ状態でWCAG 2.1 AA違反なし</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe（展開時）</code></td>
          <td class="py-2">展開状態でWCAG 2.1 AA違反なし</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">テストツール</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <ExternalLink href="https://vitest.dev/" class="text-primary hover:underline"
        >Vitest</ExternalLink
      >
      - ユニットテストランナー
    </li>
    <li>
      <ExternalLink href="https://testing-library.com/" class="text-primary hover:underline"
        >Testing Library</ExternalLink
      >
      - フレームワーク別テストユーティリティ（React、Vue、Svelte）
    </li>
    <li>
      <ExternalLink href="https://playwright.dev/" class="text-primary hover:underline"
        >Playwright</ExternalLink
      >
      - E2Eテスト用ブラウザ自動化
    </li>
    <li>
      <ExternalLink
        href="https://github.com/dequelabs/axe-core-npm/tree/develop/packages/playwright"
        class="text-primary hover:underline">axe-core/playwright</ExternalLink
      >
      - E2Eでの自動アクセシビリティテスト
    </li>
  </ul>

  <p class="text-muted-foreground text-sm">
    詳細は <ExternalLink
      href="https://github.com/masuP9/apg-patterns-examples/blob/main/.internal/testing-strategy.md"
      class="text-primary hover:underline">testing-strategy.md</ExternalLink
    > を参照してください。
  </p>
</div>
