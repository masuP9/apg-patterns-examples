---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <h3 class="mb-3 text-lg font-medium">WAI-ARIA ロール</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">ロール</th>
          <th class="py-2 pr-4 text-left">対象要素</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>feed</code></td>
          <td class="py-2 pr-4">コンテナ要素</td>
          <td class="py-2">スクロールでコンテンツが追加/削除される記事の動的リスト</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>article</code></td>
          <td class="py-2 pr-4">各記事要素</td>
          <td class="py-2">フィード内の独立したコンテンツアイテム</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>
  <p class="text-muted-foreground mb-6 text-sm">
    <ExternalLink
      href="https://www.w3.org/WAI/ARIA/apg/patterns/feed/"
      class="text-primary hover:underline"
    >
      WAI-ARIA APG Feed パターン
    </ExternalLink>
  </p>

  <div
    class="border-primary bg-primary/5 mb-6 rounded-md border-l-4 p-4"
    role="note"
    aria-labelledby="note-heading"
  >
    <p id="note-heading" class="mb-2 font-medium">
      注意: Feed はウィジェットではなくストラクチャー
    </p>
    <p class="text-muted-foreground text-sm">
      ウィジェットパターン（例: Listbox、Menu）とは異なり、Feed パターンは<strong
        >ストラクチャー</strong
      >です。これは支援技術がフィードコンテンツをナビゲートする際にデフォルトの読み上げモードを使用できることを意味します。Feed
      ロールにより、ユーザーは Page Up/Down
      で記事間を移動しながら、各記事内では自然な読み上げが可能になります。
    </p>
  </div>

  <h3 class="mb-3 text-lg font-medium">WAI-ARIA プロパティ</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">属性</th>
          <th class="py-2 pr-4 text-left">対象</th>
          <th class="py-2 pr-4 text-left">値</th>
          <th class="py-2 pr-4 text-left">必須</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-label</code></td>
          <td class="py-2 pr-4">Feed コンテナ</td>
          <td class="py-2 pr-4">テキスト</td>
          <td class="py-2 pr-4">条件付き*</td>
          <td class="py-2">フィードのアクセシブルな名前</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-labelledby</code></td>
          <td class="py-2 pr-4">Feed コンテナ</td>
          <td class="py-2 pr-4">ID参照</td>
          <td class="py-2 pr-4">条件付き*</td>
          <td class="py-2">フィードの可視見出しを参照</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-labelledby</code></td>
          <td class="py-2 pr-4">各記事</td>
          <td class="py-2 pr-4">ID参照</td>
          <td class="py-2 pr-4">はい</td>
          <td class="py-2">記事タイトル要素を参照</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-describedby</code></td>
          <td class="py-2 pr-4">各記事</td>
          <td class="py-2 pr-4">ID参照</td>
          <td class="py-2 pr-4">推奨</td>
          <td class="py-2">記事の説明またはコンテンツを参照</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-posinset</code></td>
          <td class="py-2 pr-4">各記事</td>
          <td class="py-2 pr-4">数値（1始まり）</td>
          <td class="py-2 pr-4">はい</td>
          <td class="py-2">フィード内の記事の位置（1から開始）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-setsize</code></td>
          <td class="py-2 pr-4">各記事</td>
          <td class="py-2 pr-4">数値または-1</td>
          <td class="py-2 pr-4">はい</td>
          <td class="py-2">フィード内の総記事数、不明な場合は-1</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>
  <p class="text-muted-foreground mb-6 text-sm">
    * Feed コンテナには <code>aria-label</code> または <code>aria-labelledby</code>
    のいずれかが必要です。可視見出しがある場合は <code>aria-labelledby</code> を使用してください。
  </p>

  <h3 class="mb-3 text-lg font-medium">WAI-ARIA ステート</h3>

  <div class="mb-6">
    <h4 class="mb-2 font-medium"><code>aria-busy</code></h4>
    <p class="text-muted-foreground mb-3">
      フィードが新しいコンテンツを読み込み中であることを示します。スクリーンリーダーは読み込みが完了するまで変更の通知を待機します。
    </p>
    <ResponsiveTable class="mb-2">
      <table class="w-full border-collapse">
        <tbody>
          <tr class="border-border border-b">
            <td class="w-32 py-2 pr-4 font-medium">対象</td>
            <td class="py-2">Feed コンテナ</td>
          </tr>
          <tr class="border-border border-b">
            <td class="py-2 pr-4 font-medium">値</td>
            <td class="py-2"><code>true</code> | <code>false</code></td>
          </tr>
          <tr class="border-border border-b">
            <td class="py-2 pr-4 font-medium">必須</td>
            <td class="py-2">条件付き（読み込みが発生する場合）</td>
          </tr>
          <tr class="border-border border-b">
            <td class="py-2 pr-4 font-medium">変更トリガー</td>
            <td class="py-2">読み込み開始（true）、読み込み完了（false）</td>
          </tr>
          <tr class="border-border border-b">
            <td class="py-2 pr-4 font-medium">リファレンス</td>
            <td class="py-2">
              <ExternalLink
                href="https://w3c.github.io/aria/#aria-busy"
                class="text-primary hover:underline"
              >
                aria-busy
              </ExternalLink>
            </td>
          </tr>
        </tbody>
      </table>
    </ResponsiveTable>
    <p class="text-muted-foreground mt-2 text-sm">
      <strong>注意:</strong> 複数の記事を追加する際に早期通知を防ぐため <code>true</code>
      に設定します。すべての DOM 更新が完了した後に <code>false</code> に設定します。
    </p>
  </div>

  <h3 class="mb-3 text-lg font-medium">キーボードサポート</h3>
  <ResponsiveTable class="mb-4">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">キー</th>
          <th class="py-2 text-left">アクション</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">
            <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">Page Down</kbd>
          </td>
          <td class="py-2">フォーカスをフィード内の次の記事に移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">
            <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">Page Up</kbd>
          </td>
          <td class="py-2">フォーカスをフィード内の前の記事に移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">
            <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">Ctrl</kbd>
            +
            <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">End</kbd>
          </td>
          <td class="py-2">フォーカスをフィードの後の最初のフォーカス可能要素に移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">
            <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">Ctrl</kbd>
            +
            <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">Home</kbd>
          </td>
          <td class="py-2">フォーカスをフィードの前の最初のフォーカス可能要素に移動</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>
  <p class="text-muted-foreground mb-4 text-sm">
    <strong>なぜ矢印キーではなく Page Up/Down なのか？</strong>
    フィードには記事のような長文コンテンツが含まれます。Page Up/Down を使用することで、ユーザーは記事間を移動でき、矢印キーは記事内の読み上げに使用できます。
  </p>

  <div
    class="mb-6 rounded-md border-l-4 border-amber-500 bg-amber-500/5 p-4"
    role="note"
    aria-labelledby="keyboard-docs-note-ja"
  >
    <p id="keyboard-docs-note-ja" class="mb-2 font-medium">重要: キーボード操作のドキュメント</p>
    <p class="text-muted-foreground text-sm">
      Feed パターンは Page Up/Down
      でナビゲートしますが、これは矢印キーを使用する一般的なウィジェットパターンとは異なります。
      <ExternalLink
        href="https://www.w3.org/WAI/ARIA/apg/patterns/feed/"
        class="text-primary hover:underline"
      >
        APG 仕様
      </ExternalLink>
      には次のように記載されています: <em
        >「慣習がないため、簡単に発見できるキーボードインターフェースのドキュメントを提供することが特に重要です。」</em
      >
      ユーザーがこれらのナビゲーションオプションを発見できるよう、フィードの近くにキーボード操作のヒントを常に表示してください。
    </p>
  </div>

  <h3 class="mb-3 text-lg font-medium">フォーカス管理</h3>
  <ResponsiveTable class="mb-4">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">動作</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">ローヴィング tabindex</td>
          <td class="py-2">
            1つの記事のみが <code>tabindex="0"</code>、他は <code>tabindex="-1"</code>
          </td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">初期フォーカス</td>
          <td class="py-2">
            デフォルトで最初の記事が <code>tabindex="0"</code>
          </td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">フォーカス追跡</td>
          <td class="py-2">記事間のフォーカス移動に伴い <code>tabindex</code> が更新される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">ラップなし</td>
          <td class="py-2">最初から最後、または最後から最初の記事へのラップはしない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">記事内のコンテンツ</td>
          <td class="py-2">記事内のインタラクティブ要素はキーボードでアクセス可能</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>
</div>
