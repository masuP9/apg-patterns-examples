---
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    テストは ARIA 構造、キーボードナビゲーション、フォーカス管理、動的読み込み状態の観点で APG
    準拠を検証します。Feed コンポーネントは2層のテスト戦略を使用しています。
  </p>

  <h3 class="mb-3 text-lg font-medium">テスト戦略</h3>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">ユニットテスト（Container API / Testing Library）</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      コンポーネントの HTML 出力と基本的なインタラクションを検証します。テンプレートレンダリングと
      ARIA 属性の正確性を確認します。
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>feed/article ロールを持つ HTML 構造</li>
      <li>ARIA 属性（aria-labelledby、aria-posinset、aria-setsize）</li>
      <li>初期 tabindex 値（ローヴィング tabindex）</li>
      <li>動的読み込み状態（aria-busy）</li>
      <li>CSS クラスの適用</li>
    </ul>
  </div>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">E2E テスト（Playwright）</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      実際のブラウザ環境でコンポーネントの動作を検証します。JavaScript
      の実行が必要なインタラクションをカバーします。
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>Page Up/Down による記事間のナビゲーション</li>
      <li>Ctrl+Home/End によるフィードからの脱出</li>
      <li>フォーカス管理と tabindex の更新</li>
      <li>記事内要素からのナビゲーション</li>
    </ul>
  </div>

  <h3 class="mb-3 text-lg font-medium">テストカテゴリ</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: ARIA 構造
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="feed"</code></td>
          <td class="py-2">コンテナが feed ロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="article"</code></td>
          <td class="py-2">各アイテムが article ロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-label/labelledby (feed)</code></td>
          <td class="py-2">Feed コンテナがアクセシブルな名前を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-labelledby (article)</code></td>
          <td class="py-2">各記事がタイトルを参照</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-posinset</code></td>
          <td class="py-2">1から始まる連番</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-setsize</code></td>
          <td class="py-2">総数または不明な場合は-1</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: キーボード操作
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Page Down</code></td>
          <td class="py-2">次の記事にフォーカスを移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Page Up</code></td>
          <td class="py-2">前の記事にフォーカスを移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ラップなし</code></td>
          <td class="py-2">最初/最後の記事でループしない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Ctrl+End</code></td>
          <td class="py-2">フィードの後にフォーカスを移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Ctrl+Home</code></td>
          <td class="py-2">フィードの前にフォーカスを移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>記事内から</code></td>
          <td class="py-2">記事内要素からも Page Down が動作</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: フォーカス管理
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ローヴィング tabindex</code></td>
          <td class="py-2">1つの記事のみが tabindex="0"</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex 更新</code></td>
          <td class="py-2">フォーカス移動時に tabindex が更新される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>初期状態</code></td>
          <td class="py-2">最初の記事がデフォルトで tabindex="0"</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: 動的読み込み
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-busy="false"</code></td>
          <td class="py-2">読み込み中でない場合のデフォルト状態</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-busy="true"</code></td>
          <td class="py-2">読み込み中に設定</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>フォーカス維持</code></td>
          <td class="py-2">読み込み中もフォーカスが維持される</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: アクセシビリティ
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe 違反</code></td>
          <td class="py-2">WCAG 2.1 AA 違反なし</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>読み込み状態</code></td>
          <td class="py-2">読み込み中も axe 違反なし</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-describedby</code></td>
          <td class="py-2">説明がある場合に存在</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">テストの実行</h3>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">ユニットテスト</h4>
    <pre
      class="text-muted-foreground overflow-x-auto text-sm"><code># すべての Feed ユニットテストを実行
npm run test:unit -- Feed

# フレームワーク別のテスト
npm run test:react -- Feed.test.tsx
npm run test:vue -- Feed.test.vue.ts
npm run test:svelte -- Feed.test.svelte.ts
npm run test:astro</code></pre>
  </div>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">E2E テスト</h4>
    <pre
      class="text-muted-foreground overflow-x-auto text-sm"><code># すべての Feed E2E テストを実行
npm run test:e2e -- feed.spec.ts

# UI モードで実行
npm run test:e2e:ui -- feed.spec.ts</code></pre>
  </div>
</div>
