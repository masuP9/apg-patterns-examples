---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import type { Locale } from '@/i18n';
import { localize, createTableHeaderTranslator } from '@/lib/pattern-data/i18n';
import { landmarksAccessibilityData } from './accessibility-data';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
const t = localize(locale);
const h = createTableHeaderTranslator(locale);
const data = landmarksAccessibilityData;

// Localized constraints for landmarks
const constraints: Record<string, { en: string; ja: string }> = {
  banner: {
    en: 'One per page, top-level only',
    ja: 'ページに1つ、トップレベルのみ',
  },
  navigation: {
    en: 'Multiple allowed, label when >1',
    ja: '複数可、2つ以上の場合はラベル必須',
  },
  main: {
    en: 'One per page, top-level only',
    ja: 'ページに1つ、トップレベルのみ',
  },
  contentinfo: {
    en: 'One per page, top-level only',
    ja: 'ページに1つ、トップレベルのみ',
  },
  complementary: {
    en: 'Top-level recommended',
    ja: 'トップレベル推奨',
  },
  region: {
    en: 'Requires aria-label/labelledby',
    ja: 'aria-label/labelledby必須',
  },
  search: {
    en: 'Use with form element',
    ja: 'form要素と併用',
  },
  form: {
    en: 'Requires aria-label/labelledby',
    ja: 'aria-label/labelledby必須',
  },
};
---

<div class="prose dark:prose-invert max-w-none">
  <h3 class="mb-3 text-lg font-medium">
    {locale === 'ja' ? 'WAI-ARIA ランドマークロール' : 'WAI-ARIA Landmark Roles'}
  </h3>
  <p class="text-muted-foreground mb-4">
    {t(data.overview || '')}
  </p>

  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{h('table.role')}</th>
          <th class="py-2 pr-4 text-left">
            {locale === 'ja' ? 'HTML要素' : 'HTML Element'}
          </th>
          <th class="py-2 pr-4 text-left">{h('table.description')}</th>
          <th class="py-2 text-left">{locale === 'ja' ? '制約' : 'Constraint'}</th>
        </tr>
      </thead>
      <tbody>
        {
          data.roles.map((role) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <code>{role.name}</code>
              </td>
              <td class="py-2 pr-4" set:html={t(role.element)} />
              <td class="py-2 pr-4">{t(role.description)}</td>
              <td class="py-2">
                {role.name === 'region' || role.name === 'form' ? (
                  <b>{constraints[role.name][locale]}</b>
                ) : (
                  constraints[role.name]?.[locale] || ''
                )}
              </td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">{h('section.ariaProperties')}</h3>

  <div class="mb-6">
    <h4 class="mb-2 font-medium">
      <code>aria-label</code> / <code>aria-labelledby</code>
    </h4>
    <p class="text-muted-foreground mb-3">
      {
        locale === 'ja'
          ? 'ランドマークにアクセシブルな名前を提供します。同じ種類のランドマークが複数存在する場合、またはregionとformランドマークには必須です。'
          : 'Provides an accessible name for the landmark. Required when multiple landmarks of the same type exist, or for region and form landmarks.'
      }
    </p>
    <ResponsiveTable class="mb-2">
      <table class="w-full border-collapse">
        <tbody>
          <tr class="border-border border-b">
            <td class="w-32 py-2 pr-4 font-medium">{h('table.values')}</td>
            <td class="py-2">
              {
                locale === 'ja'
                  ? '文字列（aria-label）またはID参照（aria-labelledby）'
                  : 'String (aria-label) or ID reference (aria-labelledby)'
              }
            </td>
          </tr>
          <tr class="border-border border-b">
            <td class="py-2 pr-4 font-medium">{h('table.required')}</td>
            <td class="py-2">
              <ul class="mb-0 list-disc pl-4">
                <li>
                  {
                    locale === 'ja'
                      ? '同じ種類のランドマークが複数ある場合'
                      : 'When multiple landmarks of same type exist'
                  }
                </li>
                <li>
                  {locale === 'ja' ? 'regionランドマーク（常に）' : 'For region landmarks (always)'}
                </li>
                <li>
                  {locale === 'ja' ? 'formランドマーク（常に）' : 'For form landmarks (always)'}
                </li>
              </ul>
            </td>
          </tr>
          <tr class="border-border border-b">
            <td class="py-2 pr-4 font-medium">{locale === 'ja' ? '例' : 'Example'}</td>
            <td class="py-2">
              <code>&lt;nav aria-label="{locale === 'ja' ? 'メイン' : 'Main'}"&gt;</code>
              {locale === 'ja' ? ' または ' : ' or '}
              <code>&lt;section aria-labelledby="heading-id"&gt;</code>
            </td>
          </tr>
        </tbody>
      </table>
    </ResponsiveTable>
  </div>

  <h3 class="mb-3 text-lg font-medium">{h('section.keyboardSupport')}</h3>
  <p class="text-muted-foreground mb-4">
    {t(data.keyboardDocNote || '')}
  </p>
  <ResponsiveTable class="mb-4">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">
            {locale === 'ja' ? 'スクリーンリーダー' : 'Screen Reader'}
          </th>
          <th class="py-2 text-left">{locale === 'ja' ? 'ナビゲーション方法' : 'Navigation'}</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">NVDA</td>
          <td class="py-2">
            <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">D</kbd>
            {locale === 'ja' ? 'キー' : ' key'}
          </td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">VoiceOver</td>
          <td class="py-2">
            {locale === 'ja' ? 'ローター（Webナビゲーション）' : 'Rotor (Web navigation)'}
          </td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4">JAWS</td>
          <td class="py-2">
            <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">R</kbd>
            {locale === 'ja' ? 'キーまたはセミコロン' : ' key or semicolon'}
          </td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">
    {locale === 'ja' ? 'ベストプラクティス' : 'Best Practices'}
  </h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    {data.additionalNotes?.map((note) => <li set:html={t(note)} />)}
  </ul>

  <h3 class="mb-3 text-lg font-medium">{h('section.references')}</h3>
  <ul class="list-disc space-y-2 pl-6">
    {
      data.references?.map((ref) => (
        <li>
          <ExternalLink href={ref.url} class="text-primary hover:underline">
            {ref.title}
          </ExternalLink>
        </li>
      ))
    }
  </ul>
</div>
