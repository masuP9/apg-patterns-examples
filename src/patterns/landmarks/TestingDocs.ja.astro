---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    テストでは、8つのランドマークロールがすべて存在し、適切にラベル付けされ、APGの制約に従っていることを確認します。ランドマークは静的な構造要素であるため、テストはインタラクションよりもHTML構造に焦点を当てています。
  </p>

  <h3 class="mb-3 text-lg font-medium">テスト戦略</h3>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">ユニットテスト（Container API / Testing Library）</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      コンポーネントのHTML出力とランドマーク構造を検証します。ブラウザなしで正しいレンダリングを確認できます。
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>8つのランドマークロールがすべて存在</li>
      <li>セマンティックHTML要素の使用</li>
      <li>適切なラベル付け（aria-label/aria-labelledby）</li>
      <li>制約の検証（mainは1つのみ、bannerは1つのみなど）</li>
    </ul>
  </div>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">E2Eテスト（Playwright）</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      実際のブラウザ環境でランドマーク構造を検証し、アクセシビリティ監査を実行します。
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>ランドマークロールが正しく公開される</li>
      <li>axe-coreアクセシビリティ監査</li>
      <li>フレームワーク間の一貫性</li>
    </ul>
  </div>

  <h3 class="mb-3 text-lg font-medium">テストカテゴリ</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: ランドマーク構造
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>banner ランドマーク</code></td>
          <td class="py-2">bannerロールを持つheader要素がある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>navigation ランドマーク</code></td>
          <td class="py-2">navigationロールを持つnav要素がある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>main ランドマーク</code></td>
          <td class="py-2">mainロールを持つmain要素がある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>contentinfo ランドマーク</code></td>
          <td class="py-2">contentinfoロールを持つfooter要素がある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>complementary ランドマーク</code></td>
          <td class="py-2">complementaryロールを持つaside要素がある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>region ランドマーク</code></td>
          <td class="py-2">aria-labelledbyを持つsection（regionロール）がある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>search ランドマーク</code></td>
          <td class="py-2">role="search"を持つformがある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>form ランドマーク</code></td>
          <td class="py-2">aria-label（formロール）を持つformがある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>mainは1つのみ</code></td>
          <td class="py-2">mainランドマークが1つだけ存在する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>bannerは1つのみ</code></td>
          <td class="py-2">bannerランドマークが1つだけ存在する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>contentinfoは1つのみ</code></td>
          <td class="py-2">contentinfoランドマークが1つだけ存在する</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: ランドマークのラベル付け
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>navigationのラベル</code></td>
          <td class="py-2">複数のnavigationが一意のaria-labelを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>regionのラベル</code></td>
          <td class="py-2">regionがaria-labelまたはaria-labelledbyを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>formのラベル</code></td>
          <td class="py-2">formランドマークがaria-labelを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>searchのラベル</code></td>
          <td class="py-2">searchランドマークがaria-labelを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>complementaryのラベル</code></td>
          <td class="py-2">complementaryランドマークがaria-labelを持つ</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: アクセシビリティ
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe-core監査</code></td>
          <td class="py-2">WCAG 2.1 AAの違反がない</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-green-500"></span>
    低優先度: プロパティと構造
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>className プロパティ</code></td>
          <td class="py-2">カスタムclassNameがコンテナに適用される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>showLabels プロパティ</code></td>
          <td class="py-2">有効時にランドマークラベルが表示される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>セマンティックHTML</code></td>
          <td class="py-2">header、nav、main、footer、aside、section要素を使用</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">チェックリスト（手動検証）</h3>
  <p class="text-muted-foreground mb-4">
    これらの推奨事項は手動または専用ツールで検証するのが最適です：
  </p>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>すべてのコンテンツがランドマーク内にある（推奨だが必須ではない）</li>
    <li>ランドマークの総数が7以下（多すぎると煩雑になる）</li>
    <li>スクリーンリーダーナビゲーションが正しく動作する（NVDA D キー、VoiceOver ローター）</li>
  </ul>

  <h3 class="mb-3 text-lg font-medium">テストツール</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <ExternalLink href="https://vitest.dev/" class="text-primary hover:underline"
        >Vitest</ExternalLink
      >
      - ユニットテスト用テストランナー
    </li>
    <li>
      <ExternalLink
        href="https://docs.astro.build/en/reference/container-reference/"
        class="text-primary hover:underline">Astro Container API</ExternalLink
      >
      - ユニットテスト用サーバーサイドコンポーネントレンダリング
    </li>
    <li>
      <ExternalLink href="https://playwright.dev/" class="text-primary hover:underline"
        >Playwright</ExternalLink
      >
      - E2Eテスト用ブラウザ自動化
    </li>
    <li>
      <ExternalLink href="https://www.deque.com/axe/" class="text-primary hover:underline"
        >axe-core</ExternalLink
      >
      - アクセシビリティテストエンジン
    </li>
  </ul>

  <p class="text-muted-foreground text-sm">
    詳細は<ExternalLink
      href="https://github.com/masuP9/apg-patterns-examples/blob/main/.internal/testing-strategy.md"
      class="text-primary hover:underline">testing-strategy.md</ExternalLink
    >を参照してください。
  </p>
</div>
