---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import { linkAccessibilityData } from './accessibility-data';
import { localize, createTableHeaderTranslator } from '@/lib/pattern-data/i18n';
import type { Locale } from '@/i18n';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
const t = localize(locale);
const h = createTableHeaderTranslator(locale);
const data = linkAccessibilityData;
const testing = data.testing!;

const priorityColors = {
  high: 'bg-red-500',
  medium: 'bg-yellow-500',
  low: 'bg-green-500',
};

const priorityLabels = {
  high: { en: 'High Priority', ja: '高優先度' },
  medium: { en: 'Medium Priority', ja: '中優先度' },
  low: { en: 'Low Priority', ja: '低優先度' },
};
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    {
      locale === 'ja'
        ? 'テストは、キーボード操作、ARIA属性、アクセシビリティ要件全体にわたってAPG準拠を検証します。Linkコンポーネントは2層のテスト戦略を採用しています。'
        : 'Tests verify APG compliance across keyboard interaction, ARIA attributes, and accessibility requirements. The Link component uses a two-layer testing strategy.'
    }
  </p>

  <h3 class="mb-3 text-lg font-medium">{locale === 'ja' ? 'テスト戦略' : 'Testing Strategy'}</h3>

  {
    testing.strategies.map((strategy) => (
      <div class="bg-muted/50 mb-6 rounded-lg p-4">
        <h4 class="mb-2 font-medium">{t(strategy.title)}</h4>
        <p class="text-muted-foreground mb-2 text-sm">{t(strategy.description)}</p>
        <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
          {strategy.areas.map((area) => (
            <li>{t(area)}</li>
          ))}
        </ul>
      </div>
    ))
  }

  <h3 class="mb-3 text-lg font-medium">{locale === 'ja' ? 'テストカテゴリ' : 'Test Categories'}</h3>

  {
    testing.categories.map((category) => (
      <>
        <h4 class="mb-2 flex items-center gap-2 font-medium">
          <span class={`inline-block h-3 w-3 rounded-full ${priorityColors[category.priority]}`} />
          {t(priorityLabels[category.priority])}: {t(category.title)}
        </h4>
        <ResponsiveTable class="mb-6">
          <table class="w-full border-collapse">
            <thead>
              <tr class="border-border border-b">
                <th class="py-2 pr-4 text-left">{h('test')}</th>
                <th class="py-2 text-left">{h('description')}</th>
              </tr>
            </thead>
            <tbody>
              {category.items.map((item) => (
                <tr class="border-border border-b">
                  <td class="py-2 pr-4">
                    <code>{item.name}</code>
                  </td>
                  <td class="py-2">{t(item.description)}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </ResponsiveTable>
      </>
    ))
  }

  {
    testing.categories.some(
      (c) =>
        c.priority === 'high' && typeof c.title !== 'string' && c.title.en?.includes('Keyboard')
    ) && (
      <p class="text-muted-foreground mb-6 text-sm">
        {locale === 'ja' ? (
          <>
            <strong>重要:</strong>{' '}
            ボタンとは異なり、リンクはEnterキーのみでアクティブ化され、Spaceキーでは動作しません。
            これは <code>link</code> ロールと <code>button</code> ロールの重要な違いです。
          </>
        ) : (
          <>
            <strong>Important:</strong> Unlike buttons, links are activated only by the Enter key,
            not Space. This is a key distinction between the <code>link</code> and{' '}
            <code>button</code> roles.
          </>
        )}
      </p>
    )
  }

  <h3 class="mb-3 text-lg font-medium">{locale === 'ja' ? 'テストツール' : 'Testing Tools'}</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    {
      testing.tools.map((tool) => (
        <li>
          <ExternalLink href={tool.url} class="text-primary hover:underline">
            {tool.name}
          </ExternalLink>
          - {t(tool.description)}
        </li>
      ))
    }
  </ul>

  <p class="text-muted-foreground text-sm">
    {locale === 'ja' ? '詳細なドキュメントは ' : 'See '}
    <ExternalLink href={testing.documentationLink || ''} class="text-primary hover:underline">
      testing-strategy.md
    </ExternalLink>
    {locale === 'ja' ? ' を参照してください。' : ' for full documentation.'}
  </p>
</div>
