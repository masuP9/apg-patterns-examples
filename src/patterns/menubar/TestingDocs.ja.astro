---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    テストは、キーボード操作、ARIA属性、アクセシビリティ要件全体でAPG準拠を検証します。Menubarコンポーネントは2層テスト戦略を使用しています。
  </p>

  <h3 class="mb-3 text-lg font-medium">テスト戦略</h3>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">ユニットテスト（Testing Library）</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      フレームワーク固有のTesting
      Libraryユーティリティを使用してコンポーネントのレンダリングと操作を検証します。これらのテストは分離された環境での正しいコンポーネント動作を確認します。
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>HTML構造と要素階層</li>
      <li>初期属性値（role、aria-haspopup、aria-expanded）</li>
      <li>クリックイベント処理</li>
      <li>CSSクラスの適用</li>
    </ul>
  </div>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">E2Eテスト（Playwright）</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      4つのフレームワーク全体で実際のブラウザ環境でのコンポーネント動作を検証します。これらのテストは完全なブラウザコンテキストを必要とする操作をカバーします。
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>キーボードナビゲーション（矢印キー、Enter、Space、Escape、Tab）</li>
      <li>サブメニューの開閉</li>
      <li>メニューバーの水平ナビゲーション</li>
      <li>チェックボックスとラジオアイテムの切り替え</li>
      <li>ホバーによるメニュー切り替え</li>
      <li>先行入力検索</li>
      <li>フォーカス管理とローヴィングタブインデックス</li>
      <li>クロスフレームワークの一貫性</li>
    </ul>
  </div>

  <h3 class="mb-3 text-lg font-medium">テストカテゴリ</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: APG ARIA属性
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="menubar"</code></td>
          <td class="py-2">コンテナがmenubarロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="menu"</code></td>
          <td class="py-2">ドロップダウンがmenuロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="menuitem"</code></td>
          <td class="py-2">アイテムがmenuitemロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="menuitemcheckbox"</code></td>
          <td class="py-2">チェックボックスアイテムが正しいロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="menuitemradio"</code></td>
          <td class="py-2">ラジオアイテムが正しいロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="separator"</code></td>
          <td class="py-2">区切り線がseparatorロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="group"</code></td>
          <td class="py-2">ラジオグループがaria-labelを持つgroupロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="none"</code></td>
          <td class="py-2">すべてのli要素がrole="none"を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-haspopup</code></td>
          <td class="py-2">サブメニューを持つアイテムが<code>aria-haspopup="menu"</code>を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-expanded</code></td>
          <td class="py-2">サブメニューを持つアイテムが開閉状態を反映する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-labelledby</code></td>
          <td class="py-2">サブメニューが親のmenuitemを参照する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-checked</code></td>
          <td class="py-2">チェックボックス/ラジオアイテムが正しいチェック状態を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-hidden</code></td>
          <td class="py-2"
            >メニューが閉じているとき<code>aria-hidden="true"</code>、開いているとき<code
              >"false"</code
            ></td
          >
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: APGキーボード操作 - メニューバー
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowRight</code></td>
          <td class="py-2">次のメニューバーアイテムにフォーカスを移動（ラップ）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowLeft</code></td>
          <td class="py-2">前のメニューバーアイテムにフォーカスを移動（ラップ）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowDown</code></td>
          <td class="py-2">サブメニューを開き、最初のアイテムにフォーカス</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowUp</code></td>
          <td class="py-2">サブメニューを開き、最後のアイテムにフォーカス</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Enter/Space</code></td>
          <td class="py-2">サブメニューを開く</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Home</code></td>
          <td class="py-2">最初のメニューバーアイテムにフォーカスを移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>End</code></td>
          <td class="py-2">最後のメニューバーアイテムにフォーカスを移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Tab</code></td>
          <td class="py-2">すべてのメニューを閉じ、フォーカスを外に移動</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: APGキーボード操作 - メニュー
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowDown</code></td>
          <td class="py-2">次のアイテムにフォーカスを移動（ラップ）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowUp</code></td>
          <td class="py-2">前のアイテムにフォーカスを移動（ラップ）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowRight</code></td>
          <td class="py-2">サブメニューがあれば開く、または次のメニューバーメニューに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowLeft</code></td>
          <td class="py-2">サブメニューを閉じる、または前のメニューバーメニューに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Enter/Space</code></td>
          <td class="py-2">アイテムを実行してメニューを閉じる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Escape</code></td>
          <td class="py-2">メニューを閉じ、フォーカスを親に戻す</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Home/End</code></td>
          <td class="py-2">最初/最後のアイテムにフォーカスを移動</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: チェックボックスとラジオアイテム
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>チェックボックス切り替え</code></td>
          <td class="py-2">Space/Enterでチェックボックスを切り替え</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>チェックボックスはメニューを開いたまま</code></td>
          <td class="py-2">切り替えでメニューが閉じない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-checked更新</code></td>
          <td class="py-2">切り替えでaria-checkedが更新される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ラジオ選択</code></td>
          <td class="py-2">Space/Enterでラジオを選択</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ラジオはメニューを開いたまま</code></td>
          <td class="py-2">選択でメニューが閉じない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>排他的選択</code></td>
          <td class="py-2">グループ内で1つのラジオのみがチェック可能</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: フォーカス管理（Roving Tabindex）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabIndex=0</code></td>
          <td class="py-2">最初のメニューバーアイテムがtabIndex=0を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabIndex=-1</code></td>
          <td class="py-2">他のアイテムがtabIndex=-1を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>区切り線</code></td>
          <td class="py-2">区切り線はフォーカス不可</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>無効なアイテム</code></td>
          <td class="py-2">無効なアイテムはフォーカス可能だが実行不可</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: 先行入力検索
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>文字マッチ</code></td>
          <td class="py-2">入力された文字で始まるアイテムにフォーカス</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ラップアラウンド</code></td>
          <td class="py-2">検索が末尾から先頭にラップ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>区切り線スキップ</code></td>
          <td class="py-2">検索時に区切り線をスキップ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>無効スキップ</code></td>
          <td class="py-2">検索時に無効なアイテムをスキップ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>バッファリセット</code></td>
          <td class="py-2">500ms後にバッファがリセット</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: ポインタ操作
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>クリックで開く</code></td>
          <td class="py-2">メニューバーアイテムをクリックでメニューを開く</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>クリックで切り替え</code></td>
          <td class="py-2">再度クリックでメニューを閉じる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ホバー切り替え</code></td>
          <td class="py-2">メニューが開いているとき他のアイテムにホバーでメニュー切り替え</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>アイテムクリック</code></td>
          <td class="py-2">menuitemをクリックで実行してメニューを閉じる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>外側クリック</code></td>
          <td class="py-2">外側をクリックでメニューを閉じる</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: アクセシビリティ
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe 閉じた状態</code></td>
          <td class="py-2">メニューバーが閉じているとき違反なし</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe メニュー開いた状態</code></td>
          <td class="py-2">メニューが開いているとき違反なし</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe サブメニュー開いた状態</code></td>
          <td class="py-2">サブメニューが開いているとき違反なし</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">テストツール</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <ExternalLink href="https://vitest.dev/" class="text-primary hover:underline">
        Vitest
      </ExternalLink>
      - ユニットテスト用テストランナー
    </li>
    <li>
      <ExternalLink href="https://testing-library.com/" class="text-primary hover:underline">
        Testing Library
      </ExternalLink>
      - フレームワーク固有のテストユーティリティ（React、Vue、Svelte）
    </li>
    <li>
      <ExternalLink href="https://playwright.dev/" class="text-primary hover:underline">
        Playwright
      </ExternalLink>
      - E2Eテスト用ブラウザ自動化
    </li>
    <li>
      <ExternalLink
        href="https://github.com/dequelabs/axe-core-npm/tree/develop/packages/playwright"
        class="text-primary hover:underline"
      >
        axe-core/playwright
      </ExternalLink>
      - E2Eでの自動アクセシビリティテスト
    </li>
  </ul>

  <p class="text-muted-foreground text-sm">
    詳細は
    <ExternalLink
      href="https://github.com/masuP9/apg-patterns-examples/blob/main/.internal/testing-strategy.md"
      class="text-primary hover:underline"
    >
      testing-strategy.md
    </ExternalLink>
    を参照してください。
  </p>
</div>
