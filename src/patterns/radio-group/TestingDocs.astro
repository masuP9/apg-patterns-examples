---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import CodeBlock from '@/components/ui/CodeBlock.astro';
import fs from 'node:fs';
import path from 'node:path';

// Read actual test file at build time
const e2eTestPath = path.join(process.cwd(), 'e2e/radio-group.spec.ts');
const e2eTestCode = fs.readFileSync(e2eTestPath, 'utf-8');
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    Tests verify APG compliance across keyboard interaction, ARIA attributes, focus management, and
    accessibility requirements. The Radio Group component uses a two-layer testing strategy.
  </p>

  <h3 class="mb-3 text-lg font-medium">Testing Strategy</h3>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">Unit Tests (Testing Library)</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      Verify the component's rendered output using framework-specific testing libraries. These tests
      ensure correct HTML structure and ARIA attributes.
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>ARIA attributes (aria-checked, aria-disabled, aria-orientation)</li>
      <li>Keyboard interaction (Arrow keys, Home, End, Space)</li>
      <li>Roving tabindex behavior</li>
      <li>Accessibility via jest-axe</li>
    </ul>
  </div>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">E2E Tests (Playwright)</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      Verify component behavior in a real browser environment across all frameworks. These tests
      cover interactions and cross-framework consistency.
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>Click interactions</li>
      <li>Arrow key navigation with looping</li>
      <li>Space key selection</li>
      <li>ARIA structure validation in live browser</li>
      <li>axe-core accessibility scanning</li>
      <li>Cross-framework consistency checks</li>
    </ul>
  </div>

  <h3 class="mb-3 text-lg font-medium">Test Categories</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: APG ARIA Attributes (Unit + E2E)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse text-sm">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="radiogroup"</code></td>
          <td class="py-2">Container has radiogroup role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="radio"</code></td>
          <td class="py-2">Each option has radio role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-checked</code></td>
          <td class="py-2">Selected radio has <code>aria-checked="true"</code></td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-disabled</code></td>
          <td class="py-2">Disabled radios have <code>aria-disabled="true"</code></td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-orientation</code></td>
          <td class="py-2">Only set when horizontal (vertical is default)</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>accessible name</code></td>
          <td class="py-2">Group and radios have accessible names</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: APG Keyboard Interaction (Unit + E2E)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse text-sm">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Tab focus</code></td>
          <td class="py-2">Tab focuses selected radio (or first if none)</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Tab exit</code></td>
          <td class="py-2">Tab/Shift+Tab exits the group</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Space select</code></td>
          <td class="py-2">Space selects focused radio</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Space no unselect</code></td>
          <td class="py-2">Space does not unselect already selected radio</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowDown/Right</code></td>
          <td class="py-2">Moves to next and selects</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowUp/Left</code></td>
          <td class="py-2">Moves to previous and selects</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Home</code></td>
          <td class="py-2">Moves to first and selects</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>End</code></td>
          <td class="py-2">Moves to last and selects</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Arrow wrap</code></td>
          <td class="py-2">Wraps from last to first and vice versa</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Disabled skip</code></td>
          <td class="py-2">Disabled radios skipped during navigation</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: Click Interaction (Unit + E2E)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse text-sm">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Click selects</code></td>
          <td class="py-2">Clicking radio selects it</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Click changes</code></td>
          <td class="py-2">Clicking different radio changes selection</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Disabled no click</code></td>
          <td class="py-2">Clicking disabled radio does not select it</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: Focus Management - Roving Tabindex (Unit + E2E)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse text-sm">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex="0"</code></td>
          <td class="py-2">Selected radio has tabindex="0"</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex="-1"</code></td>
          <td class="py-2">Non-selected radios have tabindex="-1"</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Disabled tabindex</code></td>
          <td class="py-2">Disabled radios have tabindex="-1"</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>First tabbable</code></td>
          <td class="py-2">First enabled radio tabbable when none selected</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Single tabbable</code></td>
          <td class="py-2">Only one tabindex="0" in group at any time</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    Medium Priority: Form Integration (Unit)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse text-sm">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>hidden input</code></td>
          <td class="py-2">Hidden input exists for form submission</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>name attribute</code></td>
          <td class="py-2">Hidden input has correct name</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>value sync</code></td>
          <td class="py-2">Hidden input value reflects selection</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    Medium Priority: Accessibility (Unit + E2E)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse text-sm">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe violations</code></td>
          <td class="py-2">No WCAG 2.1 AA violations (via jest-axe/axe-core)</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>selected axe</code></td>
          <td class="py-2">No violations with selected value</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>disabled axe</code></td>
          <td class="py-2">No violations with disabled option</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-green-500"></span>
    Low Priority: Cross-framework Consistency (E2E)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse text-sm">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>All frameworks render</code></td>
          <td class="py-2">React, Vue, Svelte, Astro all render radio groups</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Consistent click</code></td>
          <td class="py-2">All frameworks support click to select</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Consistent ARIA</code></td>
          <td class="py-2">All frameworks have consistent ARIA structure</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Consistent keyboard</code></td>
          <td class="py-2">All frameworks support keyboard navigation</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">Example Test Code</h3>
  <p class="text-muted-foreground mb-4 text-sm">
    The following is the actual E2E test file (<code>e2e/radio-group.spec.ts</code>).
  </p>
  <CodeBlock
    code={e2eTestCode}
    lang="typescript"
    title="e2e/radio-group.spec.ts"
    collapsible
    collapsedLines={20}
  />

  <h3 class="mb-3 text-lg font-medium">Running Tests</h3>
  <pre
    class="overflow-x-auto rounded-lg bg-gray-100 p-4 text-sm dark:bg-gray-800"><code># Run unit tests for Radio Group
npm run test -- radio-group

# Run E2E tests for Radio Group (all frameworks)
npm run test:e2e:pattern --pattern=radio-group

# Run E2E tests for specific framework
npm run test:e2e:react:pattern --pattern=radio-group
npm run test:e2e:vue:pattern --pattern=radio-group
npm run test:e2e:svelte:pattern --pattern=radio-group
npm run test:e2e:astro:pattern --pattern=radio-group</code></pre>

  <h3 class="mb-3 text-lg font-medium">Testing Tools</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <ExternalLink href="https://vitest.dev/" class="text-primary hover:underline"
        >Vitest</ExternalLink
      >
      - Test runner for unit tests
    </li>
    <li>
      <ExternalLink href="https://testing-library.com/" class="text-primary hover:underline"
        >Testing Library</ExternalLink
      >
      - Framework-specific testing utilities (React, Vue, Svelte)
    </li>
    <li>
      <ExternalLink href="https://playwright.dev/" class="text-primary hover:underline"
        >Playwright</ExternalLink
      >
      - Browser automation for E2E tests
    </li>
    <li>
      <ExternalLink
        href="https://github.com/dequelabs/axe-core-npm/tree/develop/packages/playwright"
        class="text-primary hover:underline">axe-core/playwright</ExternalLink
      >
      - Automated accessibility testing in E2E
    </li>
  </ul>

  <p class="text-muted-foreground text-sm">
    See <ExternalLink
      href="https://github.com/masuP9/apg-patterns-examples/blob/main/.internal/testing-strategy.md"
      class="text-primary hover:underline">testing-strategy.md</ExternalLink
    > for full documentation.
  </p>
</div>
