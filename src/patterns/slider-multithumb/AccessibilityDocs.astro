---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import { sliderMultithumbAccessibilityData } from './accessibility-data';
import { localize, createTableHeaderTranslator } from '@/lib/pattern-data/i18n';
import type { Locale } from '@/i18n';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
const t = localize(locale);
const h = createTableHeaderTranslator(locale);
const data = sliderMultithumbAccessibilityData;
---

<div class="prose dark:prose-invert max-w-none">
  <h3 class="mb-3 text-lg font-medium">{h('section.ariaRoles')}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{h('table.role')}</th>
          <th class="py-2 pr-4 text-left">{h('table.element')}</th>
          <th class="py-2 text-left">{h('table.description')}</th>
        </tr>
      </thead>
      <tbody>
        {
          data.roles.map((role) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <code>{role.name}</code>
              </td>
              <td class="py-2 pr-4">{t(role.element)}</td>
              <td class="py-2">{t(role.description)}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>
  <p class="text-muted-foreground mb-6 text-sm">
    {
      locale === 'ja' ? (
        <>
          各つまみは独自のARIA属性を持つ独立した <code>slider</code> 要素です。
          <code>group</code> ロールが2つのスライダー間のセマンティックな関係を確立します。
        </>
      ) : (
        <>
          Each thumb is an independent <code>slider</code> element with its own ARIA attributes. The{' '}
          <code>group</code> role establishes the semantic relationship between the two sliders.
        </>
      )
    }
  </p>

  <h3 class="mb-3 text-lg font-medium">{h('section.ariaProperties')}</h3>

  {
    data.properties?.map((prop) => (
      <div class="mb-6">
        <h4 class="mb-2 font-medium">
          <code>{prop.attribute}</code>
          {typeof prop.required === 'boolean' && prop.required && (
            <span class="ml-2 text-sm text-red-500">({locale === 'ja' ? '必須' : 'Required'})</span>
          )}
        </h4>
        {prop.attribute === 'aria-valuenow' && (
          <p class="text-muted-foreground mb-3">
            {locale === 'ja'
              ? '各つまみの現在の数値を示します。ユーザーが値を変更すると動的に更新されます。'
              : 'Indicates the current numeric value of each thumb. Updated dynamically as the user changes the value.'}
          </p>
        )}
        {prop.attribute === 'aria-valuemin' && (
          <>
            <p class="text-muted-foreground mb-3">
              {locale === 'ja' ? (
                <>
                  <strong>動的な境界:</strong>{' '}
                  APG仕様に従い、一方のスライダーの範囲が他方の値に依存する場合、これらの属性は動的に更新する必要があります:
                </>
              ) : (
                <>
                  <strong>Dynamic bounds:</strong> Per the APG specification, when the range of one
                  slider depends on the value of another, these attributes must update dynamically:
                </>
              )}
            </p>
            <ResponsiveTable class="mb-4">
              <table class="w-full border-collapse">
                <thead>
                  <tr class="border-border border-b">
                    <th class="py-2 pr-4 text-left">{locale === 'ja' ? 'つまみ' : 'Thumb'}</th>
                    <th class="py-2 pr-4 text-left">aria-valuemin</th>
                    <th class="py-2 text-left">aria-valuemax</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="border-border border-b">
                    <td class="py-2 pr-4">{locale === 'ja' ? '下限つまみ' : 'Lower thumb'}</td>
                    <td class="py-2 pr-4">
                      {locale === 'ja' ? '静的（絶対最小値）' : 'Static (absolute min)'}
                    </td>
                    <td class="py-2">
                      {locale === 'ja'
                        ? '動的（上限値 - minDistance）'
                        : 'Dynamic (upper value - minDistance)'}
                    </td>
                  </tr>
                  <tr class="border-border border-b">
                    <td class="py-2 pr-4">{locale === 'ja' ? '上限つまみ' : 'Upper thumb'}</td>
                    <td class="py-2 pr-4">
                      {locale === 'ja'
                        ? '動的（下限値 + minDistance）'
                        : 'Dynamic (lower value + minDistance)'}
                    </td>
                    <td class="py-2">
                      {locale === 'ja' ? '静的（絶対最大値）' : 'Static (absolute max)'}
                    </td>
                  </tr>
                </tbody>
              </table>
            </ResponsiveTable>
            <p class="text-muted-foreground mb-3 text-sm">
              {locale === 'ja'
                ? 'このアプローチにより、支援技術ユーザーに各つまみの実際の許容範囲を正しく伝えることができ、HomeキーとEndキーの動作の予測可能性が向上します。'
                : 'This approach correctly communicates to assistive technology users the actual allowed range for each thumb at any given moment, which enables better predictability of Home and End key behaviors.'}
            </p>
          </>
        )}
        {prop.attribute === 'aria-valuemax' && null}
        {prop.attribute === 'aria-valuetext' && (
          <p class="text-muted-foreground mb-3">
            {locale === 'ja'
              ? '現在の値の人間が読めるテキスト代替を提供します。数値だけでは十分な意味を伝えられない場合に使用します。'
              : "Provides a human-readable text alternative for the current value. Use when the numeric value alone doesn't convey sufficient meaning."}
          </p>
        )}
        {prop.attribute === 'aria-orientation' && (
          <p class="text-muted-foreground mb-3">
            {locale === 'ja'
              ? 'スライダーの向きを指定します。垂直スライダーの場合のみ "vertical" に設定します。水平の場合は省略します（デフォルト）。'
              : 'Specifies the orientation of the slider. Only set to "vertical" for vertical sliders; omit for horizontal (default).'}
          </p>
        )}
        {prop.attribute === 'aria-disabled' && (
          <p class="text-muted-foreground mb-3">
            {locale === 'ja'
              ? 'スライダーが無効でインタラクティブではないことを示します。'
              : 'Indicates that the slider is disabled and not interactive.'}
          </p>
        )}
        {prop.attribute !== 'aria-valuemin' && prop.attribute !== 'aria-valuemax' && (
          <ResponsiveTable class="mb-2">
            <table class="w-full border-collapse">
              <tbody>
                <tr class="border-border border-b">
                  <td class="w-32 py-2 pr-4 font-medium">{locale === 'ja' ? '型' : 'Type'}</td>
                  <td class="py-2">{t(prop.values)}</td>
                </tr>
                <tr class="border-border border-b">
                  <td class="py-2 pr-4 font-medium">{h('table.required')}</td>
                  <td class="py-2">
                    {typeof prop.required === 'boolean'
                      ? prop.required
                        ? h('value.yes')
                        : h('value.no')
                      : t(prop.required)}
                  </td>
                </tr>
                {prop.attribute === 'aria-valuetext' && (
                  <tr class="border-border border-b">
                    <td class="py-2 pr-4 font-medium">{locale === 'ja' ? '例' : 'Example'}</td>
                    <td class="py-2">"$20", "$80", "20% - 80%"</td>
                  </tr>
                )}
                {prop.attribute === 'aria-valuenow' && (
                  <tr class="border-border border-b">
                    <td class="py-2 pr-4 font-medium">{locale === 'ja' ? '範囲' : 'Range'}</td>
                    <td class="py-2">
                      {locale === 'ja' ? (
                        <>
                          <code>aria-valuemin</code> と <code>aria-valuemax</code>{' '}
                          の間である必要があります
                        </>
                      ) : (
                        <>
                          Must be between <code>aria-valuemin</code> and <code>aria-valuemax</code>
                        </>
                      )}
                    </td>
                  </tr>
                )}
                {prop.attribute === 'aria-orientation' && (
                  <tr class="border-border border-b">
                    <td class="py-2 pr-4 font-medium">
                      {locale === 'ja' ? 'デフォルト' : 'Default'}
                    </td>
                    <td class="py-2">
                      {locale === 'ja' ? 'horizontal（暗黙的）' : 'horizontal (implicit)'}
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </ResponsiveTable>
        )}
      </div>
    ))
  }

  <h3 class="mb-3 text-lg font-medium">{h('section.keyboardSupport')}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{h('table.key')}</th>
          <th class="py-2 text-left">{h('table.action')}</th>
        </tr>
      </thead>
      <tbody>
        {
          data.keyboardSupport?.map((item) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <kbd>{typeof item.key === 'string' ? item.key : t(item.key)}</kbd>
              </td>
              <td class="py-2">{t(item.action)}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">
    {locale === 'ja' ? '衝突防止' : 'Collision Prevention'}
  </h3>
  <p class="text-muted-foreground mb-3">
    {
      locale === 'ja'
        ? 'マルチサムスライダーは、つまみが互いに交差しないようにします:'
        : 'The multi-thumb slider ensures that the thumbs cannot cross each other:'
    }
  </p>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      {
        locale === 'ja' ? (
          <>
            <strong>下限つまみ</strong> - （上限値 - minDistance）を超えられない
          </>
        ) : (
          <>
            <strong>Lower thumb</strong> - Cannot exceed (upper value - minDistance)
          </>
        )
      }
    </li>
    <li>
      {
        locale === 'ja' ? (
          <>
            <strong>上限つまみ</strong> - （下限値 + minDistance）を下回れない
          </>
        ) : (
          <>
            <strong>Upper thumb</strong> - Cannot go below (lower value + minDistance)
          </>
        )
      }
    </li>
    <li>
      {
        locale === 'ja' ? (
          <>
            <strong>minDistance</strong> - つまみ間の設定可能な最小ギャップ（デフォルト: 0）
          </>
        ) : (
          <>
            <strong>minDistance</strong> - Configurable minimum gap between thumbs (default: 0)
          </>
        )
      }
    </li>
  </ul>

  <h3 class="mb-3 text-lg font-medium">{h('section.accessibleNaming')}</h3>
  <p class="text-muted-foreground mb-3">
    {
      locale === 'ja'
        ? 'マルチサムスライダーでは、2つのつまみを区別するために慎重なラベル付けが必要です。この実装は以下のアプローチをサポートしています:'
        : 'Multi-thumb sliders require careful labeling to distinguish between the two thumbs. This implementation supports several approaches:'
    }
  </p>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      {
        locale === 'ja' ? (
          <>
            <strong>表示されるグループラベル</strong> - <code>label</code>{' '}
            プロパティを使用してスライダーグループの表示ラベルを提供
          </>
        ) : (
          <>
            <strong>Visible group label</strong> - Using the <code>label</code> prop to display a
            visible label for the slider group
          </>
        )
      }
    </li>
    <li>
      <code>aria-label</code>
      {
        locale === 'ja'
          ? '（タプル）- 各つまみに個別のラベルを提供（例: ["最小価格", "最大価格"]）'
          : ' (tuple) - Provides individual labels for each thumb, e.g., ["Minimum Price", "Maximum Price"]'
      }
    </li>
    <li>
      <code>aria-labelledby</code>
      {
        locale === 'ja'
          ? '（タプル）- 外部要素を各つまみのラベルとして参照'
          : ' (tuple) - References external elements as labels for each thumb'
      }
    </li>
    <li>
      <code>getAriaLabel</code>
      {
        locale === 'ja'
          ? ' 関数 - つまみのインデックスに基づいた動的なラベル生成'
          : ' function - Dynamic label generation based on thumb index'
      }
    </li>
  </ul>

  <h3 class="mb-3 text-lg font-medium">{h('section.focusManagement')}</h3>
  <p class="text-muted-foreground mb-3">
    {locale === 'ja' ? 'この実装でのフォーカス動作:' : 'Focus behavior in this implementation:'}
  </p>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    {
      data.focusManagement?.map((rule) => (
        <li>
          <strong>{t(rule.event)}</strong> - {t(rule.behavior)}
        </li>
      ))
    }
  </ul>

  <h3 class="mb-3 text-lg font-medium">
    {locale === 'ja' ? 'ポインター操作' : 'Pointer Interaction'}
  </h3>
  <p class="text-muted-foreground mb-3">
    {
      locale === 'ja'
        ? 'この実装はマウスとタッチ操作をサポートしています:'
        : 'This implementation supports mouse and touch interaction:'
    }
  </p>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    {data.mousePointerBehavior?.map((item) => <li>{t(item)}</li>)}
  </ul>

  <h3 class="mb-3 text-lg font-medium">{h('section.visualDesign')}</h3>
  <p class="text-muted-foreground mb-3">
    {
      locale === 'ja'
        ? 'この実装は、アクセシブルなビジュアルデザインのためのWCAGガイドラインに従っています:'
        : 'This implementation follows WCAG guidelines for accessible visual design:'
    }
  </p>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    {Array.isArray(data.visualDesign) && data.visualDesign.map((item) => <li>{t(item)}</li>)}
  </ul>

  <h3 class="mb-3 text-lg font-medium">{h('section.references')}</h3>
  {
    data.references && (
      <ul class="list-disc space-y-2 pl-6">
        {data.references.map((ref) => (
          <li>
            <ExternalLink href={ref.url} class="text-primary hover:underline">
              {ref.title}
            </ExternalLink>
          </li>
        ))}
      </ul>
    )
  }
</div>
