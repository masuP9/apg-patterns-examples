---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import CodeBlock from '@/components/ui/CodeBlock.astro';
import { sliderMultithumbAccessibilityData } from './accessibility-data';
import { localize } from '@/lib/pattern-data/i18n';
import type { Locale } from '@/i18n';
import e2eTestCode from '../../../e2e/slider-multithumb.spec.ts?raw';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
const t = localize(locale);
const data = sliderMultithumbAccessibilityData.testing!;

const translations = {
  en: {
    intro:
      'Tests verify APG compliance for ARIA attributes, keyboard interactions, collision prevention, and accessibility requirements for multi-thumb sliders.',
    testingStrategy: 'Testing Strategy',
    testCategories: 'Test Categories',
    e2eTesting: 'E2E Testing',
    exampleTestCode: 'Example Test Code',
    exampleTestCodeDescription:
      'The following is the actual E2E test file (<code>e2e/slider-multithumb.spec.ts</code>).',
    runningTests: 'Running Tests',
    testingTools: 'Testing Tools',
    documentation: 'See',
    documentationText: 'for full documentation.',
    priorityHigh: 'High Priority',
    priorityMedium: 'Medium Priority',
    priorityLow: 'Low Priority',
    test: 'Test',
    description: 'Description',
  },
  ja: {
    intro:
      'テストは、ARIA属性、キーボードインタラクション、衝突防止、マルチサムスライダーのアクセシビリティ要件のAPG準拠を検証します。',
    testingStrategy: 'テスト戦略',
    testCategories: 'テストカテゴリ',
    e2eTesting: 'E2Eテスト',
    exampleTestCode: 'テストコード例',
    exampleTestCodeDescription:
      '以下は実際のE2Eテストファイル（<code>e2e/slider-multithumb.spec.ts</code>）です。',
    runningTests: 'テストの実行',
    testingTools: 'テストツール',
    documentation: '完全なドキュメントについては',
    documentationText: 'を参照してください。',
    priorityHigh: '高優先度',
    priorityMedium: '中優先度',
    priorityLow: '低優先度',
    test: 'テスト',
    description: '説明',
  },
};

const tr = translations[locale];

const priorityColors = {
  high: 'bg-red-500',
  medium: 'bg-yellow-500',
  low: 'bg-green-500',
};

const priorityLabels = {
  high: tr.priorityHigh,
  medium: tr.priorityMedium,
  low: tr.priorityLow,
};
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    {tr.intro}
  </p>

  <h3 class="mb-3 text-lg font-medium">{tr.testCategories}</h3>

  {
    data.categories.map((category) => (
      <>
        <h4 class="mb-2 flex items-center gap-2 font-medium">
          <span class={`inline-block h-3 w-3 rounded-full ${priorityColors[category.priority]}`} />
          {priorityLabels[category.priority]}: {t(category.title)}
        </h4>
        <ResponsiveTable class="mb-6">
          <table class="w-full border-collapse">
            <thead>
              <tr class="border-border border-b">
                <th class="py-2 pr-4 text-left">{tr.test}</th>
                <th class="py-2 text-left">{tr.description}</th>
              </tr>
            </thead>
            <tbody>
              {category.items.map((item) => (
                <tr class="border-border border-b">
                  <td class="py-2 pr-4">
                    <code>{item.name}</code>
                  </td>
                  <td class="py-2">{t(item.description)}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </ResponsiveTable>
      </>
    ))
  }

  <h3 class="mb-3 text-lg font-medium">{tr.exampleTestCode}</h3>
  <p class="text-muted-foreground mb-4 text-sm" set:html={tr.exampleTestCodeDescription} />
  <CodeBlock
    code={e2eTestCode}
    lang="typescript"
    title="e2e/slider-multithumb.spec.ts"
    collapsible
    collapsedLines={20}
  />

  <h3 class="mb-3 text-lg font-medium">{tr.runningTests}</h3>
  <pre
    class="overflow-x-auto rounded-lg bg-gray-100 p-4 text-sm dark:bg-gray-800"><code>{`# Run unit tests for MultiThumbSlider
npm run test -- MultiThumbSlider

# Run E2E tests for MultiThumbSlider (all frameworks)
npm run test:e2e:pattern --pattern=slider-multithumb

# Run E2E tests for specific framework
npm run test:e2e:react:pattern --pattern=slider-multithumb
npm run test:e2e:vue:pattern --pattern=slider-multithumb
npm run test:e2e:svelte:pattern --pattern=slider-multithumb
npm run test:e2e:astro:pattern --pattern=slider-multithumb`}</code></pre>

  <h3 class="mb-3 text-lg font-medium">{tr.testingTools}</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    {
      data.tools.map((tool) => (
        <li>
          <ExternalLink href={tool.url} class="text-primary hover:underline">
            {tool.name}
          </ExternalLink>
          - {t(tool.description)}
        </li>
      ))
    }
  </ul>
</div>
