---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import CodeBlock from '@/components/ui/CodeBlock.astro';
import e2eTestCode from '../../../e2e/slider-multithumb.spec.ts?raw';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    テストは、ARIA属性、キーボード操作、衝突防止、マルチサムスライダーのアクセシビリティ要件に関するAPG準拠を検証します。
  </p>

  <h3 class="mb-3 text-lg font-medium">テストカテゴリ</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: ARIA構造
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>two slider elements</code></td>
          <td class="py-2">コンテナにrole="slider"を持つ要素が2つある</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="group"</code></td>
          <td class="py-2">スライダーがaria-labelledbyを持つグループに含まれている</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-valuenow</code></td>
          <td class="py-2">両方のつまみが正しい初期値を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>static aria-valuemin</code></td>
          <td class="py-2">下限つまみは静的な最小値（絶対最小値）を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>static aria-valuemax</code></td>
          <td class="py-2">上限つまみは静的な最大値（絶対最大値）を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>dynamic aria-valuemax</code></td>
          <td class="py-2">下限つまみの最大値は上限つまみの値に依存する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>dynamic aria-valuemin</code></td>
          <td class="py-2">上限つまみの最小値は下限つまみの値に依存する</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: 動的境界値の更新
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>lower → upper bound</code></td>
          <td class="py-2">下限つまみを動かすと上限つまみのaria-valueminが更新される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>upper → lower bound</code></td>
          <td class="py-2">上限つまみを動かすと下限つまみのaria-valuemaxが更新される</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: キーボード操作
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Arrow Right/Up</code></td>
          <td class="py-2">値を1ステップ増加させる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Arrow Left/Down</code></td>
          <td class="py-2">値を1ステップ減少させる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Home (lower)</code></td>
          <td class="py-2">下限つまみを絶対最小値に設定する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>End (lower)</code></td>
          <td class="py-2">下限つまみを動的最大値（上限 - minDistance）に設定する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Home (upper)</code></td>
          <td class="py-2">上限つまみを動的最小値（下限 + minDistance）に設定する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>End (upper)</code></td>
          <td class="py-2">上限つまみを絶対最大値に設定する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Page Up/Down</code></td>
          <td class="py-2">値を大きなステップで増加/減少させる</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: 衝突防止
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>lower cannot exceed upper</code></td>
          <td class="py-2">下限つまみは（上限 - minDistance）で停止する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>upper cannot go below lower</code></td>
          <td class="py-2">上限つまみは（下限 + minDistance）で停止する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>rapid key presses</code></td>
          <td class="py-2">矢印キーを素早く押してもつまみは交差しない</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: フォーカス管理
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Tab order</code></td>
          <td class="py-2">Tabキーで下限つまみから上限つまみに移動する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Shift+Tab order</code></td>
          <td class="py-2">Shift+Tabキーで上限つまみから下限つまみに移動する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex="0"</code></td>
          <td class="py-2">両方のつまみがtabindex="0"を持つ（常にタブ順序に含まれる）</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: aria-valuetextの更新
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>lower thumb update</code></td>
          <td class="py-2">下限つまみの値が変わるとaria-valuetextが更新される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>upper thumb update</code></td>
          <td class="py-2">上限つまみの値が変わるとaria-valuetextが更新される</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: アクセシビリティ
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe violations (container)</code></td>
          <td class="py-2">コンテナにアクセシビリティ違反がない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe violations (sliders)</code></td>
          <td class="py-2">各スライダー要素にアクセシビリティ違反がない</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">E2Eテスト</h3>
  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-blue-500"></span>
    クロスフレームワーク整合性
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>render two sliders</code></td>
          <td class="py-2">全フレームワークで2つのスライダー要素を描画する</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>consistent initial values</code></td>
          <td class="py-2">全フレームワークで同じ初期aria-valuenow値を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>keyboard navigation</code></td>
          <td class="py-2">全フレームワークで同じキーボードナビゲーションをサポートする</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>collision prevention</code></td>
          <td class="py-2">全フレームワークでつまみの交差を防止する</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">テストコード例</h3>
  <p class="text-muted-foreground mb-4 text-sm">
    以下は実際のE2Eテストファイル（<code>e2e/slider-multithumb.spec.ts</code>）です。
  </p>
  <CodeBlock
    code={e2eTestCode}
    lang="typescript"
    title="e2e/slider-multithumb.spec.ts"
    collapsible
    collapsedLines={20}
  />

  <h3 class="mb-3 text-lg font-medium">テストの実行</h3>
  <pre
    class="overflow-x-auto rounded-lg bg-gray-100 p-4 text-sm dark:bg-gray-800"><code># MultiThumbSliderのユニットテストを実行
npm run test -- MultiThumbSlider

# MultiThumbSliderのE2Eテストを実行（全フレームワーク）
npm run test:e2e:pattern --pattern=slider-multithumb

# 特定フレームワークのE2Eテストを実行
npm run test:e2e:react:pattern --pattern=slider-multithumb
npm run test:e2e:vue:pattern --pattern=slider-multithumb
npm run test:e2e:svelte:pattern --pattern=slider-multithumb
npm run test:e2e:astro:pattern --pattern=slider-multithumb</code></pre>

  <h3 class="mb-3 text-lg font-medium">テストツール</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <ExternalLink href="https://vitest.dev/" class="text-primary hover:underline"
        >Vitest</ExternalLink
      >
      - ユニットテスト用テストランナー
    </li>
    <li>
      <ExternalLink href="https://playwright.dev/" class="text-primary hover:underline"
        >Playwright</ExternalLink
      >
      - E2Eテスト用ブラウザ自動化
    </li>
    <li>
      <ExternalLink
        href="https://github.com/dequelabs/axe-core"
        class="text-primary hover:underline"
      >
        axe-core
      </ExternalLink>
      - アクセシビリティテストエンジン
    </li>
    <li>
      <ExternalLink href="https://testing-library.com/" class="text-primary hover:underline">
        Testing Library
      </ExternalLink>
      - フレームワーク別テストユーティリティ
    </li>
  </ul>
</div>
