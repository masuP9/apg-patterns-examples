---
import { ResponsiveTable } from '@/components/ui/table';
import { sliderAccessibilityData } from './accessibility-data';
import { localize } from '@/lib/pattern-data/i18n';
import type { Locale } from '@/i18n';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
const t = localize(locale);
const data = sliderAccessibilityData;
const considerations = data.nativeHtmlConsiderations;
const comparisonRows = data.nativeVsCustom || [];
const footnote = data.nativeHtmlFootnote;

// Type guard for single NativeHtmlConsideration object
const nativeHtml = considerations && !Array.isArray(considerations) ? considerations : undefined;

const translations = {
  en: {
    title: 'Use Native HTML First',
    useCase: 'Use Case',
    nativeHtml: 'Native HTML',
    customImpl: 'Custom Implementation',
  },
  ja: {
    title: 'ネイティブ HTML を優先',
    useCase: 'ユースケース',
    nativeHtml: 'ネイティブ HTML',
    customImpl: 'カスタム実装',
  },
};

const tr = translations[locale];
---

<div class="border-primary mb-8 rounded-lg border-2 p-4">
  <h2 class="mb-2 flex items-center gap-2 text-lg font-bold">
    <span aria-hidden="true">⚠️</span>
    {tr.title}
  </h2>
  {
    nativeHtml?.recommendation && (
      <p class="mb-4">
        <strong class="text-red-700 dark:text-red-400" set:html={t(nativeHtml.recommendation)} />
      </p>
    )
  }
  {
    nativeHtml?.codeExample && (
      <div class="bg-muted mb-4 rounded-md p-3">
        <pre class="m-0 overflow-x-auto text-sm">
          <code>{nativeHtml.codeExample}</code>
        </pre>
      </div>
    )
  }
  {nativeHtml?.benefits && <p class="mb-4 text-sm">{t(nativeHtml.benefits)}</p>}

  {
    comparisonRows.length > 0 && (
      <ResponsiveTable>
        <table class="w-full border-collapse">
          <thead>
            <tr class="border-border border-b">
              <th class="py-2 pr-4 text-left">{tr.useCase}</th>
              <th class="py-2 pr-4 text-left">{tr.nativeHtml}</th>
              <th class="py-2 text-left">{tr.customImpl}</th>
            </tr>
          </thead>
          <tbody>
            {comparisonRows.map((row) => (
              <tr class="border-border border-b">
                <td class="py-2 pr-4">{t(row.useCase || '')}</td>
                <td class="py-2 pr-4">
                  {row.nativeRecommended ? (
                    <b class="text-green-700 dark:text-green-400">{t(row.native)}</b>
                  ) : (
                    t(row.native)
                  )}
                </td>
                <td class="py-2">
                  {!row.nativeRecommended ? (
                    <b class="text-green-700 dark:text-green-400">{t(row.custom)}</b>
                  ) : (
                    t(row.custom)
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </ResponsiveTable>
    )
  }
  {footnote && <p class="text-muted-foreground mt-3 text-xs" set:html={t(footnote)} />}
</div>
