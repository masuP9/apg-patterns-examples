---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
import { spinbuttonAccessibilityData } from './accessibility-data';
import { localize, createTableHeaderTranslator } from '@/lib/pattern-data/i18n';
import type { Locale } from '@/i18n';

interface Props {
  locale?: Locale;
}

const { locale = 'en' } = Astro.props;
const t = localize(locale);
const h = createTableHeaderTranslator(locale);
const data = spinbuttonAccessibilityData;
---

<div class="prose dark:prose-invert max-w-none">
  <h3 class="mb-3 text-lg font-medium">{h('section.ariaRoles')}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{h('table.role')}</th>
          <th class="py-2 pr-4 text-left">{h('table.element')}</th>
          <th class="py-2 text-left">{h('table.description')}</th>
        </tr>
      </thead>
      <tbody>
        {
          data.roles.map((role) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <code>{role.name}</code>
              </td>
              <td class="py-2 pr-4">{t(role.element)}</td>
              <td class="py-2">{t(role.description)}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>
  {
    data.additionalNotes && data.additionalNotes.length > 0 && (
      <p class="text-muted-foreground mb-6 text-sm">{t(data.additionalNotes[0])}</p>
    )
  }

  <h3 class="mb-3 text-lg font-medium">
    {locale === 'ja' ? 'WAI-ARIA ステートとプロパティ' : 'WAI-ARIA States and Properties'}
  </h3>

  {
    data.properties?.map((prop) => (
      <div class="mb-6">
        <h4 class="mb-2 font-medium">
          <code>{prop.attribute}</code>
          {typeof prop.required === 'boolean' && prop.required && (
            <span class="ml-2 text-sm font-normal">({locale === 'ja' ? '必須' : 'Required'})</span>
          )}
        </h4>
        {prop.notes && <p class="text-muted-foreground mb-3">{t(prop.notes)}</p>}
        <ResponsiveTable class="mb-2">
          <table class="w-full border-collapse">
            <tbody>
              <tr class="border-border border-b">
                <td class="w-32 py-2 pr-4 font-medium">{locale === 'ja' ? '型' : 'Type'}</td>
                <td class="py-2">{t(prop.values)}</td>
              </tr>
              <tr class="border-border border-b">
                <td class="py-2 pr-4 font-medium">{h('table.required')}</td>
                <td class="py-2">
                  {typeof prop.required === 'boolean'
                    ? prop.required
                      ? h('value.yes')
                      : h('value.no')
                    : t(prop.required)}
                </td>
              </tr>
              {prop.attribute === 'aria-valuenow' && (
                <tr class="border-border border-b">
                  <td class="py-2 pr-4 font-medium">{locale === 'ja' ? '更新' : 'Update'}</td>
                  <td class="py-2">{t(prop.notes!)}</td>
                </tr>
              )}
              {(prop.attribute === 'aria-valuemin' || prop.attribute === 'aria-valuemax') && (
                <tr class="border-border border-b">
                  <td class="py-2 pr-4 font-medium">{locale === 'ja' ? '注意' : 'Note'}</td>
                  <td class="py-2">{t(prop.notes!)}</td>
                </tr>
              )}
              {prop.attribute === 'aria-valuetext' && (
                <tr class="border-border border-b">
                  <td class="py-2 pr-4 font-medium">{locale === 'ja' ? '例' : 'Example'}</td>
                  <td class="py-2">"5 items", "3 of 10", "Tuesday"</td>
                </tr>
              )}
            </tbody>
          </table>
        </ResponsiveTable>
      </div>
    ))
  }

  <h3 class="mb-3 text-lg font-medium">{h('section.keyboardSupport')}</h3>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">{h('table.key')}</th>
          <th class="py-2 text-left">{h('table.action')}</th>
        </tr>
      </thead>
      <tbody>
        {
          data.keyboardSupport?.map((shortcut) => (
            <tr class="border-border border-b">
              <td class="py-2 pr-4">
                <kbd class="rounded bg-gray-100 px-2 py-1 dark:bg-gray-800">{shortcut.key}</kbd>
              </td>
              <td class="py-2">{t(shortcut.action)}</td>
            </tr>
          ))
        }
      </tbody>
    </table>
  </ResponsiveTable>
  {
    data.additionalNotes && data.additionalNotes.length > 1 && (
      <p class="text-muted-foreground mb-6 text-sm">
        <strong>{locale === 'ja' ? '注意:' : 'Note:'}</strong> {t(data.additionalNotes[1])}
      </p>
    )
  }

  <h3 class="mb-3 text-lg font-medium">{h('section.accessibleNaming')}</h3>
  <p class="text-muted-foreground mb-3">
    {
      locale === 'ja'
        ? 'スピンボタンにはアクセシブルな名前が必要です。これは以下の方法で提供できます:'
        : 'Spinbuttons must have an accessible name. This can be provided through:'
    }
  </p>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      {
        locale === 'ja' ? (
          <>
            <strong>可視ラベル</strong> - <code>label</code> プロップを使用して可視ラベルを表示
          </>
        ) : (
          <>
            <strong>Visible label</strong> - Using the <code>label</code> prop to display a visible
            label
          </>
        )
      }
    </li>
    <li>
      <code>aria-label</code> -
      {
        locale === 'ja'
          ? 'スピンボタンに不可視のラベルを提供'
          : 'Provides an invisible label for the spinbutton'
      }
    </li>
    <li>
      <code>aria-labelledby</code> -
      {
        locale === 'ja'
          ? '外部要素をラベルとして参照'
          : 'References an external element as the label'
      }
    </li>
  </ul>

  <h3 class="mb-3 text-lg font-medium">
    {locale === 'ja' ? 'テキスト入力' : 'Text Input'}
  </h3>
  <p class="text-muted-foreground mb-3">
    {
      locale === 'ja'
        ? 'この実装では直接テキスト入力をサポートしています:'
        : 'This implementation supports direct text input:'
    }
  </p>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      {
        locale === 'ja' ? (
          <>
            <strong>数値キーボード</strong> - 最適なモバイル体験のために{' '}
            <code>inputmode="numeric"</code> を使用
          </>
        ) : (
          <>
            <strong>Numeric keyboard</strong> - Uses <code>inputmode="numeric"</code> for optimal
            mobile experience
          </>
        )
      }
    </li>
    <li>
      {
        locale === 'ja' ? (
          <>
            <strong>リアルタイムバリデーション</strong> -
            各入力時に値をクランプし、ステップに丸めます
          </>
        ) : (
          <>
            <strong>Real-time validation</strong> - Value is clamped and rounded to step on each
            input
          </>
        )
      }
    </li>
    <li>
      {
        locale === 'ja' ? (
          <>
            <strong>無効な入力の処理</strong> -
            入力が無効な場合、フォーカスを外したときに以前の有効な値に戻します
          </>
        ) : (
          <>
            <strong>Invalid input handling</strong> - Reverts to previous valid value on blur if
            input is invalid
          </>
        )
      }
    </li>
    <li>
      {
        locale === 'ja' ? (
          <>
            <strong>IMEサポート</strong> - 変換が完了するまで待ってから値を更新します
          </>
        ) : (
          <>
            <strong>IME support</strong> - Waits for composition to complete before updating value
          </>
        )
      }
    </li>
  </ul>

  <h3 class="mb-3 text-lg font-medium">{h('section.visualDesign')}</h3>
  <p class="text-muted-foreground mb-3">
    {
      locale === 'ja'
        ? 'この実装はアクセシブルなビジュアルデザインのためのWCAGガイドラインに従っています:'
        : 'This implementation follows WCAG guidelines for accessible visual design:'
    }
  </p>
  {
    data.visualDesign && (
      <ul class="mb-6 list-disc space-y-2 pl-6">
        {data.visualDesign.map((item) => {
          const text = t(item);
          const dashIndex = text.indexOf(' - ');
          if (dashIndex > -1) {
            return (
              <li>
                <strong>{text.substring(0, dashIndex)}</strong> - {text.substring(dashIndex + 3)}
              </li>
            );
          }
          return <li>{text}</li>;
        })}
      </ul>
    )
  }

  <h3 class="mb-3 text-lg font-medium">{h('section.references')}</h3>
  {
    data.references && (
      <ul class="list-disc space-y-2 pl-6">
        {data.references.map((ref) => (
          <li>
            <ExternalLink href={ref.url} class="text-primary hover:underline">
              {ref.title}
            </ExternalLink>
          </li>
        ))}
      </ul>
    )
  }
</div>
