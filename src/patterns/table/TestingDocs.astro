---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    Tests verify APG compliance for ARIA roles, table structure, and accessibility requirements.
    Since Table is a static structure, keyboard interaction tests are not applicable.
  </p>

  <h3 class="mb-3 text-lg font-medium">Test Categories</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: ARIA Structure
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="table"</code></td>
          <td class="py-2">Container element has the table role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="rowgroup"</code></td>
          <td class="py-2">Header and body groups have rowgroup role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="row"</code></td>
          <td class="py-2">All rows have the row role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="columnheader"</code></td>
          <td class="py-2">Header cells have columnheader role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="rowheader"</code></td>
          <td class="py-2">Row header cells have rowheader role when specified</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="cell"</code></td>
          <td class="py-2">Data cells have the cell role</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: Accessible Name
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-label</code></td>
          <td class="py-2">Accessible name via aria-label attribute</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-labelledby</code></td>
          <td class="py-2">Accessible name via external element reference</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>caption</code></td>
          <td class="py-2">Caption is displayed when provided</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: Sort State
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-sort="ascending"</code></td>
          <td class="py-2">Column sorted in ascending order</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-sort="descending"</code></td>
          <td class="py-2">Column sorted in descending order</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-sort="none"</code></td>
          <td class="py-2">Sortable column that is not currently sorted</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>no aria-sort</code></td>
          <td class="py-2">Non-sortable columns have no aria-sort attribute</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>onSortChange callback</code></td>
          <td class="py-2">Callback is invoked when sort button is clicked</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>sort toggle</code></td>
          <td class="py-2">Clicking sorted column toggles direction</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    Medium Priority: Virtualization Support
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-colcount</code></td>
          <td class="py-2">Total column count for virtualized tables</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-rowcount</code></td>
          <td class="py-2">Total row count for virtualized tables</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-rowindex</code></td>
          <td class="py-2">Row position in the full table</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-colindex</code></td>
          <td class="py-2">Cell position in the full table</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    Medium Priority: Visual Cell Spanning (Browser Tests)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>colspan width</code></td>
          <td class="py-2">Cell with colspan=2 has ~2x width of normal cell</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>rowspan height</code></td>
          <td class="py-2">Cell with rowspan=2 has ~2x height of normal cell</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>full span</code></td>
          <td class="py-2">Cell spanning all columns matches table width</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>combined spans</code></td>
          <td class="py-2">Cell with both colspan and rowspan has correct dimensions</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>
  <p class="text-muted-foreground mb-6 text-sm">
    <strong>Note:</strong> Visual spanning tests use <code>getBoundingClientRect()</code> and require
    a real browser environment (Vitest browser mode with Playwright). These tests are in
    <code>*.browser.test.ts</code> files.
  </p>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    Medium Priority: Accessibility
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe violations</code></td>
          <td class="py-2">No accessibility violations detected by axe-core</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>sortable columns</code></td>
          <td class="py-2">No violations with sortable column headers</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>row headers</code></td>
          <td class="py-2">No violations with row header cells</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>empty table</code></td>
          <td class="py-2">No violations with empty data rows</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    Medium Priority: Edge Cases
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>empty rows</code></td>
          <td class="py-2">Table renders correctly with no data rows</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>single column</code></td>
          <td class="py-2">Table handles single column correctly</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-green-500"></span>
    Low Priority: HTML Attribute Inheritance
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>className</code></td>
          <td class="py-2">Custom class is applied to container</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>id</code></td>
          <td class="py-2">ID attribute is set correctly</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>data-*</code></td>
          <td class="py-2">Data attributes are passed through</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">Testing Tools</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <strong>React:</strong>
      <ExternalLink
        href="https://testing-library.com/docs/react-testing-library/intro/"
        class="text-primary hover:underline"
      >
        React Testing Library
      </ExternalLink>
    </li>
    <li>
      <strong>Vue:</strong>
      <ExternalLink
        href="https://testing-library.com/docs/vue-testing-library/intro/"
        class="text-primary hover:underline"
      >
        Vue Testing Library
      </ExternalLink>
    </li>
    <li>
      <strong>Svelte:</strong>
      <ExternalLink
        href="https://testing-library.com/docs/svelte-testing-library/intro/"
        class="text-primary hover:underline"
      >
        Svelte Testing Library
      </ExternalLink>
    </li>
    <li>
      <strong>Astro:</strong> Vitest with JSDOM for Web Component unit tests
    </li>
    <li>
      <strong>Accessibility:</strong>
      <ExternalLink
        href="https://github.com/dequelabs/axe-core"
        class="text-primary hover:underline"
      >
        axe-core
      </ExternalLink>
    </li>
  </ul>
</div>
