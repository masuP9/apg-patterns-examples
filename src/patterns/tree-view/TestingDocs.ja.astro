---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    テストでは、ARIA
    属性、キーボード操作、展開/折りたたみ動作、選択モデル、およびアクセシビリティ要件の APG
    準拠を検証します。
  </p>

  <h3 class="mb-3 text-lg font-medium">テストカテゴリ</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: ARIA 構造
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="tree"</code></td>
          <td class="py-2">コンテナ要素が tree ロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="treeitem"</code></td>
          <td class="py-2">各ノードが treeitem ロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="group"</code></td>
          <td class="py-2">子コンテナが group ロールを持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-expanded（親）</code></td>
          <td class="py-2">親ノードが aria-expanded を持つ（true または false）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-expanded（リーフ）</code></td>
          <td class="py-2">リーフノードは aria-expanded を持たない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-selected</code></td>
          <td class="py-2">すべての treeitem が aria-selected を持つ（true または false）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-multiselectable</code></td>
          <td class="py-2">複数選択モードでツリーが aria-multiselectable="true" を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-disabled</code></td>
          <td class="py-2">無効化されたノードが aria-disabled="true" を持つ</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: アクセシブル名
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-label</code></td>
          <td class="py-2">ツリーが aria-label でアクセシブル名を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-labelledby</code></td>
          <td class="py-2">ツリーが aria-labelledby を使用できる（優先される）</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: ナビゲーション
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowDown</code></td>
          <td class="py-2">次の表示されているノードに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowUp</code></td>
          <td class="py-2">前の表示されているノードに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Home</code></td>
          <td class="py-2">最初のノードに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>End</code></td>
          <td class="py-2">最後の表示されているノードに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>先行入力</code></td>
          <td class="py-2">文字入力で一致する表示されているノードにフォーカス</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: 展開/折りたたみ
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowRight（閉じた親）</code></td>
          <td class="py-2">親ノードを展開</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowRight（開いた親）</code></td>
          <td class="py-2">最初の子に移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowRight（リーフ）</code></td>
          <td class="py-2">何もしない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowLeft（開いた親）</code></td>
          <td class="py-2">親ノードを折りたたむ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowLeft（子/閉じた親）</code></td>
          <td class="py-2">親ノードに移動</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowLeft（ルート）</code></td>
          <td class="py-2">何もしない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>*（アスタリスク）</code></td>
          <td class="py-2">現在のレベルのすべての兄弟を展開</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Enter</code></td>
          <td class="py-2">ノードをアクティブ化（展開/折りたたみはしない）</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: 選択（単一選択）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>矢印ナビゲーション</code></td>
          <td class="py-2">選択がフォーカスに追従（矢印キーで選択が変更）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Space</code></td>
          <td class="py-2">単一選択モードでは効果なし</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>選択は1つのみ</code></td>
          <td class="py-2">一度に1つのノードのみ選択可能</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: 選択（複数選択）
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Space</code></td>
          <td class="py-2">フォーカス中のノードの選択をトグル</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Ctrl+Space</code></td>
          <td class="py-2">フォーカスを移動せずに選択をトグル</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Shift+矢印</code></td>
          <td class="py-2">アンカーから選択範囲を拡張</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Shift+Home</code></td>
          <td class="py-2">最初のノードまで選択を拡張</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Shift+End</code></td>
          <td class="py-2">最後の表示されているノードまで選択を拡張</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Ctrl+A</code></td>
          <td class="py-2">表示されているすべてのノードを選択</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>複数選択</code></td>
          <td class="py-2">複数のノードを同時に選択可能</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    高優先度: フォーカス管理
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>単一タブストップ</code></td>
          <td class="py-2">ツリーは単一のタブストップ（Tab/Shift+Tab）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex="0"</code></td>
          <td class="py-2">フォーカス中のノードが tabindex="0" を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex="-1"</code></td>
          <td class="py-2">その他のノードが tabindex="-1" を持つ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>折りたたまれた子をスキップ</code></td>
          <td class="py-2">ナビゲーション中に折りたたまれた子はスキップ</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>親へフォーカス移動</code></td>
          <td class="py-2">子の親が折りたたまれるとフォーカスが親に移動</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: 無効化されたノード
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>フォーカス可能</code></td>
          <td class="py-2">無効化されたノードはフォーカスを受け取れる</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>選択不可</code></td>
          <td class="py-2">無効化されたノードは選択できない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>展開不可</code></td>
          <td class="py-2">無効化された親ノードは展開/折りたたみできない</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>アクティブ化不可</code></td>
          <td class="py-2">Enter キーで無効化されたノードはアクティブ化されない</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: 先行入力
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>表示ノードのみ</code></td>
          <td class="py-2">先行入力は表示されているノードのみを検索</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>繰り返しでサイクル</code></td>
          <td class="py-2">同じ文字の繰り返しでマッチを順に巡回</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>複数文字プレフィックス</code></td>
          <td class="py-2">複数の文字が検索プレフィックスを形成</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>タイムアウトリセット</code></td>
          <td class="py-2">タイムアウト後にバッファがリセット（デフォルト500ms）</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>無効ノードをスキップ</code></td>
          <td class="py-2">先行入力は無効化されたノードをスキップ</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    中優先度: マウス操作
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>親をクリック</code></td>
          <td class="py-2">展開をトグルしてノードを選択</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>リーフをクリック</code></td>
          <td class="py-2">リーフノードを選択</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>無効ノードをクリック</code></td>
          <td class="py-2">無効化されたノードは選択または展開できない</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-green-500"></span>
    低優先度: コールバック
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">テスト</th>
          <th class="py-2 text-left">説明</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>onSelectionChange</code></td>
          <td class="py-2">選択変更時に選択された ID で呼び出される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>onExpandedChange</code></td>
          <td class="py-2">展開変更時に展開された ID で呼び出される</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>onActivate</code></td>
          <td class="py-2">Enter キーでノード ID と共に呼び出される</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">テストツール</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <strong>React:</strong>
      <ExternalLink
        href="https://testing-library.com/docs/react-testing-library/intro/"
        class="text-primary hover:underline"
      >
        React Testing Library
      </ExternalLink>
    </li>
    <li>
      <strong>Vue:</strong>
      <ExternalLink
        href="https://testing-library.com/docs/vue-testing-library/intro/"
        class="text-primary hover:underline"
      >
        Vue Testing Library
      </ExternalLink>
    </li>
    <li>
      <strong>Svelte:</strong>
      <ExternalLink
        href="https://testing-library.com/docs/svelte-testing-library/intro/"
        class="text-primary hover:underline"
      >
        Svelte Testing Library
      </ExternalLink>
    </li>
    <li>
      <strong>Astro:</strong> Web Component ユニットテスト用の Vitest と JSDOM
    </li>
    <li>
      <strong>アクセシビリティ:</strong>
      <ExternalLink
        href="https://github.com/dequelabs/axe-core"
        class="text-primary hover:underline"
      >
        axe-core
      </ExternalLink>
    </li>
  </ul>
</div>
