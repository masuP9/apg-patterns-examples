---
import ExternalLink from '@/components/ui/ExternalLink.astro';
import { ResponsiveTable } from '@/components/ui/table';
---

<div class="prose dark:prose-invert max-w-none">
  <p class="text-muted-foreground mb-4">
    Tests verify APG compliance across keyboard interaction, ARIA attributes, and accessibility
    requirements. The TreeGrid component combines Grid and TreeView testing strategies.
  </p>

  <h3 class="mb-3 text-lg font-medium">Testing Strategy</h3>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">Unit Tests (Testing Library)</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      Verify component rendering and interactions using framework-specific Testing Library
      utilities. These tests ensure correct component behavior in isolation.
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>HTML structure and element hierarchy (treegrid, row, rowheader, gridcell)</li>
      <li>Initial attribute values (role, aria-label, aria-level, aria-expanded)</li>
      <li>Selection state changes (aria-selected on rows)</li>
      <li>Hierarchy depth indicators (aria-level)</li>
      <li>CSS class application</li>
    </ul>
  </div>

  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <h4 class="mb-2 font-medium">E2E Tests (Playwright)</h4>
    <p class="text-muted-foreground mb-2 text-sm">
      Verify component behavior in a real browser environment across all four frameworks. These
      tests cover interactions that require full browser context.
    </p>
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>2D keyboard navigation (Arrow keys)</li>
      <li>Tree operations at rowheader (ArrowRight/Left for expand/collapse)</li>
      <li>Extended navigation (Home, End, Ctrl+Home, Ctrl+End)</li>
      <li>Row selection with Space</li>
      <li>Focus management and roving tabindex</li>
      <li>Hidden row handling (collapsed children)</li>
      <li>Cross-framework consistency</li>
    </ul>
  </div>

  <h3 class="mb-3 text-lg font-medium">Test Categories</h3>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: APG ARIA Attributes
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="treegrid"</code></td>
          <td class="py-2">Container has treegrid role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="row"</code></td>
          <td class="py-2">All rows have row role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="rowheader"</code></td>
          <td class="py-2">First cell in row has rowheader role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="gridcell"</code></td>
          <td class="py-2">Other cells have gridcell role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>role="columnheader"</code></td>
          <td class="py-2">Header cells have columnheader role</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-label</code></td>
          <td class="py-2">TreeGrid has accessible name via aria-label</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-level</code></td>
          <td class="py-2">All rows have aria-level (1-based depth)</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-expanded</code></td>
          <td class="py-2">Parent rows have aria-expanded (true/false)</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-selected on row</code></td>
          <td class="py-2">Selection on row element (not cell)</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>aria-multiselectable</code></td>
          <td class="py-2">Present when multi-selection is enabled</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: Tree Operations (at Rowheader)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowRight expands</code></td>
          <td class="py-2">Expands collapsed parent row</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowRight to child</code></td>
          <td class="py-2">Moves to first child when already expanded</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowLeft collapses</code></td>
          <td class="py-2">Collapses expanded parent row</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowLeft to parent</code></td>
          <td class="py-2">Moves to parent row when collapsed or leaf</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Enter activates only</code></td>
          <td class="py-2">Enter does NOT expand/collapse (unlike Tree)</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Children hidden</code></td>
          <td class="py-2">Child rows hidden when parent collapsed</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: 2D Keyboard Navigation
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowRight (non-rowheader)</code></td>
          <td class="py-2">Moves focus one cell right</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowLeft (non-rowheader)</code></td>
          <td class="py-2">Moves focus one cell left</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowDown</code></td>
          <td class="py-2">Moves focus to next visible row</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>ArrowUp</code></td>
          <td class="py-2">Moves focus to previous visible row</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Skip hidden rows</code></td>
          <td class="py-2">ArrowDown/Up skips collapsed children</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: Extended Navigation
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Home</code></td>
          <td class="py-2">Moves focus to first cell in row</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>End</code></td>
          <td class="py-2">Moves focus to last cell in row</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Ctrl+Home</code></td>
          <td class="py-2">Moves focus to first cell in first visible row</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Ctrl+End</code></td>
          <td class="py-2">Moves focus to last cell in last visible row</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: Focus Management (Roving Tabindex)
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex="0"</code></td>
          <td class="py-2">First focusable cell has tabindex="0"</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>tabindex="-1"</code></td>
          <td class="py-2">Other cells have tabindex="-1"</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Headers not focusable</code></td>
          <td class="py-2">columnheader cells have no tabindex</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Tab exits treegrid</code></td>
          <td class="py-2">Tab moves focus out of treegrid</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Focus update</code></td>
          <td class="py-2">Focused cell updates tabindex on navigation</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-red-500"></span>
    High Priority: Row Selection
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Space toggles row</code></td>
          <td class="py-2">Space toggles row selection (not cell)</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Single select</code></td>
          <td class="py-2">Single selection clears previous on Space</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Multi select</code></td>
          <td class="py-2">Multi-selection allows multiple rows</td>
        </tr>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>Enter activates cell</code></td>
          <td class="py-2">Enter triggers cell activation</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h4 class="mb-2 flex items-center gap-2 font-medium">
    <span class="inline-block h-3 w-3 rounded-full bg-yellow-500"></span>
    Medium Priority: Accessibility
  </h4>
  <ResponsiveTable class="mb-6">
    <table class="w-full border-collapse">
      <thead>
        <tr class="border-border border-b">
          <th class="py-2 pr-4 text-left">Test</th>
          <th class="py-2 text-left">Description</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-border border-b">
          <td class="py-2 pr-4"><code>axe-core</code></td>
          <td class="py-2">No accessibility violations</td>
        </tr>
      </tbody>
    </table>
  </ResponsiveTable>

  <h3 class="mb-3 text-lg font-medium">Key Difference from Grid</h3>
  <div class="bg-muted/50 mb-6 rounded-lg p-4">
    <ul class="text-muted-foreground list-disc space-y-1 pl-6 text-sm">
      <li>
        <strong>Selection target:</strong> TreeGrid selects <em>rows</em> (aria-selected on row), Grid
        selects <em>cells</em>
      </li>
      <li>
        <strong>Arrow behavior at rowheader:</strong> ArrowRight/Left do tree operations, not cell navigation
      </li>
      <li>
        <strong>Hierarchy:</strong> Must test aria-level values and parent/child relationships
      </li>
      <li><strong>Hidden rows:</strong> Must skip collapsed children during navigation</li>
    </ul>
  </div>

  <h3 class="mb-3 text-lg font-medium">Testing Tools</h3>
  <ul class="mb-6 list-disc space-y-2 pl-6">
    <li>
      <ExternalLink href="https://vitest.dev/" class="text-primary hover:underline">
        Vitest
      </ExternalLink>
      - Test runner for unit tests
    </li>
    <li>
      <ExternalLink href="https://testing-library.com/" class="text-primary hover:underline">
        Testing Library
      </ExternalLink>
      - Framework-specific testing utilities (React, Vue, Svelte)
    </li>
    <li>
      <ExternalLink href="https://playwright.dev/" class="text-primary hover:underline">
        Playwright
      </ExternalLink>
      - Browser automation for E2E tests
    </li>
    <li>
      <ExternalLink
        href="https://github.com/dequelabs/axe-core-npm/tree/develop/packages/playwright"
        class="text-primary hover:underline"
      >
        axe-core/playwright
      </ExternalLink>
      - Automated accessibility testing in E2E
    </li>
  </ul>

  <p class="text-muted-foreground text-sm">
    See
    <ExternalLink
      href="https://github.com/masuP9/apg-patterns-examples/blob/main/.internal/testing-strategy.md"
      class="text-primary hover:underline"
    >
      testing-strategy.md
    </ExternalLink>
    for full documentation.
  </p>
</div>
